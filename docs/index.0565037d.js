var e={};!function(){var t={};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"16px Monospace",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,e),this.x=s,this.y=a,this.ctx=t,this.canvas=i,this.color=o,this.font=r,this.setPos=this.setPos.bind(this)}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"track",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.canvas;return e?t.addEventListener("mousemove",this.setPos):t.removeEventListener("mousemove",this.setPos),this}},{key:"setPos",value:function(e){var t=this.canvas.getBoundingClientRect();return this.x=Math.floor(e.clientX-t.left),this.y=Math.floor(e.clientY-t.top),this}},{key:"draw",value:function(){var e=this.x,t=this.y,n=this.canvas,i=this.ctx,o=this.font,r=this.color,s="X: ".concat(e,", Y: ").concat(t);i.save(),i.fillStyle=r,i.font=o;var a=e<n.width/2?20:-i.measureText(s).width-20,l=t<n.height/2?25:-18;return i.fillText(s,this.x+a,this.y+l),i.restore(),this}}]),e}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var l=function(){function e(t,n,i,o,s,a){r(this,e),this.color=t,this.lineWidth=n,this.startX=i,this.startY=o,this.endX=s,this.endY=a}return a(e,[{key:"draw",value:function(e){var t=this.color,n=this.lineWidth,i=this.startX,o=this.startY,r=this.endX,s=this.endY;e.save(),e.beginPath(),e.strokeStyle=t,e.lineWidth=n,e.moveTo(i,o),e.lineTo(r,s),e.stroke(),e.restore()}}]),e}(),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gray",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DarkGray",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"16px Monospace";r(this,e),this.color=t,this.lineWidth=n,this.step=i,this.boldNth=o,this.boldColor=s,this.boldWidth=a,this.font=l,this.lines=null}return a(e,[{key:"createLines",value:function(e){for(var t=this.color,n=this.lineWidth,i=this.step,o=this.boldNth,r=this.boldColor,s=this.boldWidth,a=[],h=o*i,c=0;c<e.width;c+=i){var u=c%h==0;a.push(u?new l(r,s,c,0,c,e.height):new l(t,n,c,0,c,e.height))}for(var f=0;f<e.height;f+=i){var d=f%h==0;a.push(d?new l(r,s,0,f,e.width,f):new l(t,n,0,f,e.width,f))}this.lines=a}},{key:"drawText",value:function(e,t){var n=this.step,i=this.boldNth,o=this.boldColor,r=this.font;e.save(),e.font=r,e.fillStyle=o,e.fillText("0",1,15);for(var s=n*i;s<t.width;s+=n*i)e.fillText(s,s,15);for(var a=n*i;a<t.height;a+=n*i)e.fillText(a,0,a+15);e.restore()}},{key:"draw",value:function(e,t){this.lines||this.createLines(t),this.lines.forEach((function(t){return t.draw(e)})),this.drawText(e,t)}}]),e}();t.Mouse=o,t.Grid=h,e=t}();var t,n,i={},o=i={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,h=[],c=!1,u=-1;function f(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&d())}function d(){if(!c){var e=a(f);c=!0;for(var t=h.length;t;){for(l=h,h=[];++u<t;)l&&l[u].run();u=-1,t=h.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}function v(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function p(e,t){for(var n,i="",o=0,r=-1,s=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(r===a-1||1===s);else if(r!==a-1&&2===s){if(i.length<2||2!==o||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){-1===l?(i="",o=0):o=(i=i.slice(0,l)).length-1-i.lastIndexOf("/"),r=a,s=0;continue}}else if(2===i.length||1===i.length){i="",o=0,r=a,s=0;continue}t&&(i.length>0?i+="/..":i="..",o=2)}else i.length>0?i+="/"+e.slice(r+1,a):i=e.slice(r+1,a),o=a-r-1;r=a,s=0}else 46===n&&-1!==s?++s:s=-1}return i}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new m(e,t)),1!==h.length||c||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0};var w={resolve:function(){for(var e,t="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var r;o>=0?r=arguments[o]:(void 0===e&&(e=i.cwd()),r=e),v(r),0!==r.length&&(t=r+"/"+t,n=47===r.charCodeAt(0))}return t=p(t,!n),n?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(v(e),0===e.length)return".";var t=47===e.charCodeAt(0),n=47===e.charCodeAt(e.length-1);return 0!==(e=p(e,!t)).length||t||(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return v(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];v(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":w.normalize(e)},relative:function(e,t){if(v(e),v(t),e===t)return"";if((e=w.resolve(e))===(t=w.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var i=e.length,o=i-n,r=1;r<t.length&&47===t.charCodeAt(r);++r);for(var s=t.length-r,a=o<s?o:s,l=-1,h=0;h<=a;++h){if(h===a){if(s>a){if(47===t.charCodeAt(r+h))return t.slice(r+h+1);if(0===h)return t.slice(r+h)}else o>a&&(47===e.charCodeAt(n+h)?l=h:0===h&&(l=0));break}var c=e.charCodeAt(n+h);if(c!==t.charCodeAt(r+h))break;47===c&&(l=h)}var u="";for(h=n+l+1;h<=i;++h)h!==i&&47!==e.charCodeAt(h)||(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(r+l):(r+=l,47===t.charCodeAt(r)&&++r,t.slice(r))},_makeLong:function(e){return e},dirname:function(e){if(v(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,i=-1,o=!0,r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!o){i=r;break}}else o=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');v(e);var n,i=0,o=-1,r=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var s=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){var l=e.charCodeAt(n);if(47===l){if(!r){i=n+1;break}}else-1===a&&(r=!1,a=n+1),s>=0&&(l===t.charCodeAt(s)?-1==--s&&(o=n):(s=-1,o=a))}return i===o?o=a:-1===o&&(o=e.length),e.slice(i,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!r){i=n+1;break}}else-1===o&&(r=!1,o=n+1);return-1===o?"":e.slice(i,o)},extname:function(e){v(e);for(var t=-1,n=0,i=-1,o=!0,r=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===i&&(o=!1,i=s+1),46===a?-1===t?t=s:1!==r&&(r=1):-1!==t&&(r=-1);else if(!o){n=s+1;break}}return-1===t||-1===i||0===r||1===r&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+i:n+e+i:i}("/",e)},parse:function(e){v(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var n,i=e.charCodeAt(0),o=47===i;o?(t.root="/",n=1):n=0;for(var r=-1,s=0,a=-1,l=!0,h=e.length-1,c=0;h>=n;--h)if(47!==(i=e.charCodeAt(h)))-1===a&&(l=!1,a=h+1),46===i?-1===r?r=h:1!==c&&(c=1):-1!==r&&(c=-1);else if(!l){s=h+1;break}return-1===r||-1===a||0===c||1===c&&r===a-1&&r===s+1?-1!==a&&(t.base=t.name=0===s&&o?e.slice(1,a):e.slice(s,a)):(0===s&&o?(t.name=e.slice(1,r),t.base=e.slice(1,a)):(t.name=e.slice(s,r),t.base=e.slice(s,a)),t.ext=e.slice(r,a)),s>0?t.dir=e.slice(0,s-1):o&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};w.posix=w;const y=document.getElementsByTagName("body")[0],b=document.getElementById("fileInput"),T=document.getElementById("uploadButton"),x=document.getElementById("padsField"),C=document.getElementById("coordsField"),A=document.getElementById("dropZone"),E=document.getElementById("canvas"),k=document.getElementById("progress"),O=document.getElementById("progressbar"),X=document.getElementsByTagName("header")[0],Y=document.getElementsByTagName("footer")[0];let $,L,P,B=null,F=1,z=1,S="";class M{constructor(e,t,n){this.form=e,this.width=t,this.height=n}}class I{constructor(e,t,n){this.posX=t,this.posY=n,this.style=e}}class R{fileName="";mouseFlag=!1;mouseStartX=0;mouseStartY=0;mouseOffX=0;mouseOffY=0;zoom=6;constructor(e,t){this.ctx=e,this.canvas=t,this.mapStyles=new Map,this.mapPads=new Map}draw(){this.ctx.fillStyle="antiquewhite",this.ctx.beginPath(),this.ctx.moveTo(-10+this.mouseOffX,0+this.mouseOffY),this.ctx.lineTo(10+this.mouseOffX,0+this.mouseOffY),this.ctx.moveTo(0+this.mouseOffX,-10+this.mouseOffY),this.ctx.lineTo(0+this.mouseOffX,10+this.mouseOffY),this.ctx.stroke(),this.ctx.beginPath();for(let e of this.mapPads.keys()){const t=this.mapStyles.get(e),n=this.mapPads.get(e);if(t&&n){const e=t.width*this.zoom,i=t.height*this.zoom;for(let o of n.values())if("R"==t.form||"O"==t.form)this.ctx.fillRect(o.posX*this.zoom-e/2+this.mouseOffX,o.posY*this.zoom-i/2+this.mouseOffY,e,i);else{if("C"!=t.form){console.log(`draw quatsch ${t}`);break}this.ctx.arc(o.posX*this.zoom-e/2+this.mouseOffX,o.posY*this.zoom-i/2+this.mouseOffY,t.width*this.zoom,0,359)}}}this.ctx.fill()}addPadStyle(e,t,n,i){this.mapStyles.set(e,new M(t,n,i))}addPad(e,t,n){this.mapPads.has(e)||this.mapPads.set(e,new Set);let i=this.mapPads.get(e);i&&i.add(new I(e,t,n))}mouseDown(e){this.mouseStartX=e.clientX-this.mouseOffX,this.mouseStartY=e.clientY-this.mouseOffY,this.mouseFlag=!0}mouseUp(e){this.mouseFlag=!1}mouseMove(e){this.mouseFlag&&(this.mouseOffX=e.clientX-this.mouseStartX,this.mouseOffY=e.clientY-this.mouseStartY)}mouseWheel(e){e.deltaY>0?this.zoom*=1.1:this.zoom*=.9}}function W(){E&&B&&(window.requestAnimationFrame(W),B.clearRect(0,0,E.width,E.height),L.draw(B,E),$.draw(),P&&P.draw())}function D(e){b&&T&&x&&C&&y&&B&&k&&e.arrayBuffer().then((t=>{var n,i,o,r;n="UTF-8",i=t=>{x.innerHTML="",C.innerHTML="",A&&(A.innerText=e.name),async function(e){if(b&&T&&x&&C&&y&&E&&B&&k){k.style.display="block",P=new R(B,E);const t=(e=e.replace(/\r/g,"")).split("\n");let n=1;for(let e of t)n++,await N(e),O&&(O.style.width=100*n/t.length+"%");k.style.display="none"}}(t)},o=new Blob([t],{type:"text/plain"}),(r=new FileReader).onload=e=>{i(e.target.result)},r.readAsText(o,n)}))}async function N(e){return new Promise((t=>{if(b&&T&&x&&C&&y&&B&&k){const t=e.match(/^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/);t&&(z=parseInt(t[1]),F=parseInt(t[2]),console.log(`gerber: float digits = ${z} ${F}`));const n=e.match(/^(%AD)(D[0-9]+)([A-Za-z])[,]([0-9.]+)[X]?([0-9.]+)?/);n&&(x.innerHTML+=`${n[2]} ${n[4]} ${n[5]}<br>`,P.addPadStyle(n[2],n[3],parseFloat(n[4]),parseFloat(n[5])),console.log(`gerber: style ${n[2]},${n[3]}, ${parseFloat(n[4])}, ${parseFloat(n[5])}`));const i=e.match(/^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/),o=e.match(/^(D[0-9]+)[*]/);if(o&&(S=o[1]),i){let e=i[2],t=i[4];const n=z+F;for(;e.length<n;)e=`0${e}`;for(;t.length<n;)t=`0${t}`;let o=0,r=0;e=`${e.substring(0,z)}.${e.substring(z)}`,t=`${t.substring(0,z)}.${t.substring(z)}`,o=parseFloat(e),r=parseFloat(t),"-"==i[1]&&(o*=-1),"-"==i[3]&&(r*=-1),C.innerHTML+=`${S}:  x:${o} y:${r} <br>`,P.addPad(S,o,r)}}setTimeout(t,0)}))}document.addEventListener("DOMContentLoaded",(function(){console.log("moinsen"),b&&T&&x&&C&&y&&E?(B=E.getContext("2d"),E.addEventListener("mousemove",(e=>{P&&P.mouseMove(e)}),!1),E.addEventListener("mousedown",(e=>{P&&P.mouseDown(e)}),!1),E.addEventListener("mouseup",(e=>{P&&P.mouseUp(e)}),!1),E.addEventListener("mouseout",(e=>{P&&P.mouseUp(e)}),!1),E.addEventListener("wheel",(e=>{P&&P.mouseWheel(e)}),!1),T.onclick=()=>{if(b.files&&b.files.length>0){let e=b.files[0];console.log(e),console.log(`file: ${e.name} size:${e.size}`),D(e)}else alert("please choose a file")},y.ondrop=e=>{e.preventDefault(),console.log(e),e.dataTransfer.items?[...e.dataTransfer.items].forEach(((e,t)=>{if("file"===e.kind){const n=e.getAsFile();n&&(console.log(`… item[${t}].name = ${n.name}`),D(n))}})):[...e.dataTransfer.files].forEach(((e,t)=>{e&&(console.log(`… file[${t}].name = ${e.name}`),D(e))}))},y.ondragover=e=>{console.log("File(s) in drop zone"),e.preventDefault()},E.width=innerWidth,E.height=innerHeight-X.getBoundingClientRect().height-Y.getBoundingClientRect().height-7,$=new(0,e.Mouse)(B,E),$.track(),L=new(0,e.Grid),window.requestAnimationFrame(W)):console.error("missing html elements !")})),window.addEventListener("resize",(e=>{console.log(`resize: ${e}`),E&&X&&Y&&(E.width=innerWidth,E.height=innerHeight-X.getBoundingClientRect().height-Y.getBoundingClientRect().height-7,$.draw(),L.draw(B,E))}));
//# sourceMappingURL=index.0565037d.js.map
