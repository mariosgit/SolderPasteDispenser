var e={};!function(){var t={};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"16px Monospace",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,e),this.x=r,this.y=h,this.ctx=t,this.canvas=i,this.color=o,this.font=s,this.setPos=this.setPos.bind(this)}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"track",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.canvas;return e?t.addEventListener("mousemove",this.setPos):t.removeEventListener("mousemove",this.setPos),this}},{key:"setPos",value:function(e){var t=this.canvas.getBoundingClientRect();return this.x=Math.floor(e.clientX-t.left),this.y=Math.floor(e.clientY-t.top),this}},{key:"draw",value:function(){var e=this.x,t=this.y,n=this.canvas,i=this.ctx,o=this.font,s=this.color,r="X: ".concat(e,", Y: ").concat(t);i.save(),i.fillStyle=s,i.font=o;var h=e<n.width/2?20:-i.measureText(r).width-20,a=t<n.height/2?25:-18;return i.fillText(r,this.x+h,this.y+a),i.restore(),this}}]),e}();function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a=function(){function e(t,n,i,o,r,h){s(this,e),this.color=t,this.lineWidth=n,this.startX=i,this.startY=o,this.endX=r,this.endY=h}return h(e,[{key:"draw",value:function(e){var t=this.color,n=this.lineWidth,i=this.startX,o=this.startY,s=this.endX,r=this.endY;e.save(),e.beginPath(),e.strokeStyle=t,e.lineWidth=n,e.moveTo(i,o),e.lineTo(s,r),e.stroke(),e.restore()}}]),e}(),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gray",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DarkGray",h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"16px Monospace";s(this,e),this.color=t,this.lineWidth=n,this.step=i,this.boldNth=o,this.boldColor=r,this.boldWidth=h,this.font=a,this.lines=null}return h(e,[{key:"createLines",value:function(e){for(var t=this.color,n=this.lineWidth,i=this.step,o=this.boldNth,s=this.boldColor,r=this.boldWidth,h=[],l=o*i,c=0;c<e.width;c+=i){var f=c%l==0;h.push(f?new a(s,r,c,0,c,e.height):new a(t,n,c,0,c,e.height))}for(var u=0;u<e.height;u+=i){var d=u%l==0;h.push(d?new a(s,r,0,u,e.width,u):new a(t,n,0,u,e.width,u))}this.lines=h}},{key:"drawText",value:function(e,t){var n=this.step,i=this.boldNth,o=this.boldColor,s=this.font;e.save(),e.font=s,e.fillStyle=o,e.fillText("0",1,15);for(var r=n*i;r<t.width;r+=n*i)e.fillText(r,r,15);for(var h=n*i;h<t.height;h+=n*i)e.fillText(h,0,h+15);e.restore()}},{key:"draw",value:function(e,t){this.lines||this.createLines(t),this.lines.forEach((function(t){return t.draw(e)})),this.drawText(e,t)}}]),e}();t.Mouse=o,t.Grid=l,e=t}();var t,n,i={},o=i={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function h(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var a,l=[],c=!1,f=-1;function u(){c&&a&&(c=!1,a.length?l=a.concat(l):f=-1,l.length&&d())}function d(){if(!c){var e=h(u);c=!0;for(var t=l.length;t;){for(a=l,l=[];++f<t;)a&&a[f].run();f=-1,t=l.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}function v(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function p(e,t){for(var n,i="",o=0,s=-1,r=0,h=0;h<=e.length;++h){if(h<e.length)n=e.charCodeAt(h);else{if(47===n)break;n=47}if(47===n){if(s===h-1||1===r);else if(s!==h-1&&2===r){if(i.length<2||2!==o||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var a=i.lastIndexOf("/");if(a!==i.length-1){-1===a?(i="",o=0):o=(i=i.slice(0,a)).length-1-i.lastIndexOf("/"),s=h,r=0;continue}}else if(2===i.length||1===i.length){i="",o=0,s=h,r=0;continue}t&&(i.length>0?i+="/..":i="..",o=2)}else i.length>0?i+="/"+e.slice(s+1,h):i=e.slice(s+1,h),o=h-s-1;s=h,r=0}else 46===n&&-1!==r?++r:r=-1}return i}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||c||h(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0};var y={resolve:function(){for(var e,t="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var s;o>=0?s=arguments[o]:(void 0===e&&(e=i.cwd()),s=e),v(s),0!==s.length&&(t=s+"/"+t,n=47===s.charCodeAt(0))}return t=p(t,!n),n?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(v(e),0===e.length)return".";var t=47===e.charCodeAt(0),n=47===e.charCodeAt(e.length-1);return 0!==(e=p(e,!t)).length||t||(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return v(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];v(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":y.normalize(e)},relative:function(e,t){if(v(e),v(t),e===t)return"";if((e=y.resolve(e))===(t=y.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var i=e.length,o=i-n,s=1;s<t.length&&47===t.charCodeAt(s);++s);for(var r=t.length-s,h=o<r?o:r,a=-1,l=0;l<=h;++l){if(l===h){if(r>h){if(47===t.charCodeAt(s+l))return t.slice(s+l+1);if(0===l)return t.slice(s+l)}else o>h&&(47===e.charCodeAt(n+l)?a=l:0===l&&(a=0));break}var c=e.charCodeAt(n+l);if(c!==t.charCodeAt(s+l))break;47===c&&(a=l)}var f="";for(l=n+a+1;l<=i;++l)l!==i&&47!==e.charCodeAt(l)||(0===f.length?f+="..":f+="/..");return f.length>0?f+t.slice(s+a):(s+=a,47===t.charCodeAt(s)&&++s,t.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(v(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,i=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!o){i=s;break}}else o=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');v(e);var n,i=0,o=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var r=t.length-1,h=-1;for(n=e.length-1;n>=0;--n){var a=e.charCodeAt(n);if(47===a){if(!s){i=n+1;break}}else-1===h&&(s=!1,h=n+1),r>=0&&(a===t.charCodeAt(r)?-1==--r&&(o=n):(r=-1,o=h))}return i===o?o=h:-1===o&&(o=e.length),e.slice(i,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){i=n+1;break}}else-1===o&&(s=!1,o=n+1);return-1===o?"":e.slice(i,o)},extname:function(e){v(e);for(var t=-1,n=0,i=-1,o=!0,s=0,r=e.length-1;r>=0;--r){var h=e.charCodeAt(r);if(47!==h)-1===i&&(o=!1,i=r+1),46===h?-1===t?t=r:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){n=r+1;break}}return-1===t||-1===i||0===s||1===s&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,i=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+i:n+e+i:i}("/",e)},parse:function(e){v(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var n,i=e.charCodeAt(0),o=47===i;o?(t.root="/",n=1):n=0;for(var s=-1,r=0,h=-1,a=!0,l=e.length-1,c=0;l>=n;--l)if(47!==(i=e.charCodeAt(l)))-1===h&&(a=!1,h=l+1),46===i?-1===s?s=l:1!==c&&(c=1):-1!==s&&(c=-1);else if(!a){r=l+1;break}return-1===s||-1===h||0===c||1===c&&s===h-1&&s===r+1?-1!==h&&(t.base=t.name=0===r&&o?e.slice(1,h):e.slice(r,h)):(0===r&&o?(t.name=e.slice(1,s),t.base=e.slice(1,h)):(t.name=e.slice(r,s),t.base=e.slice(r,h)),t.ext=e.slice(s,h)),r>0?t.dir=e.slice(0,r-1):o&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};y.posix=y;const w=document.getElementsByTagName("body")[0],b=document.getElementById("uploadButton"),x=document.getElementById("padsField"),T=document.getElementById("coordsField"),O=document.getElementById("dropZone"),k=document.getElementById("canvas"),C=document.getElementById("progress"),A=document.getElementById("progressbar"),E=document.getElementsByTagName("header")[0],X=document.getElementsByTagName("footer")[0];let Y,$,L,P=null,z=1,S=1,F="";class B{minx=9999;miny=9999;maxx=-9999;maxy=-9999;constructor(){}update(e,t){e<this.minx&&(this.minx=e),t<this.miny&&(this.miny=t),e>this.maxx&&(this.maxx=e),t>this.maxy&&(this.maxy=t)}center(){return[(this.maxx-this.minx)/2,(this.maxy-this.miny)/2]}}class M{constructor(e,t,n){this.form=e,this.width=t,this.height=n}}class I{constructor(e,t,n){this.posX=t,this.posY=n,this.style=e}}class R{fileName="";mouseFlag=!1;mouseStartX=0;mouseStartY=0;mouseOffX=0;mouseOffY=0;zoom=6;constructor(e,t){this.ctx=e,this.canvas=t,this.mapStyles=new Map,this.mapPads=new Map,this.bb=new B}draw(){this.ctx.fillStyle="antiquewhite",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.moveTo(-10+this.mouseOffX,0+this.mouseOffY),this.ctx.lineTo(10+this.mouseOffX,0+this.mouseOffY),this.ctx.moveTo(0+this.mouseOffX,-10+this.mouseOffY),this.ctx.lineTo(0+this.mouseOffX,10+this.mouseOffY),this.ctx.stroke(),this.ctx.strokeStyle="red";let e=this.bb.center();e[0]=e[0]*this.zoom,e[1]=e[1]*this.zoom,this.ctx.beginPath(),this.ctx.moveTo(e[0]-10+this.mouseOffX,e[1]+this.mouseOffY),this.ctx.lineTo(e[0]+10+this.mouseOffX,e[1]+this.mouseOffY),this.ctx.moveTo(e[0]+this.mouseOffX,e[1]-10+this.mouseOffY),this.ctx.lineTo(e[0]+this.mouseOffX,e[1]+10+this.mouseOffY),this.ctx.stroke(),this.ctx.beginPath();for(let e of this.mapPads.keys()){const t=this.mapStyles.get(e),n=this.mapPads.get(e);if(t&&n){const e=t.width*this.zoom,i=t.height*this.zoom;for(let o of n.values())if("R"==t.form||"O"==t.form)this.ctx.fillRect(o.posX*this.zoom-e/2+this.mouseOffX,o.posY*this.zoom-i/2+this.mouseOffY,e,i);else{if("C"!=t.form){console.log(`draw quatsch ${t}`);break}this.ctx.arc(o.posX*this.zoom-e/2+this.mouseOffX,o.posY*this.zoom-i/2+this.mouseOffY,t.width*this.zoom,0,359)}}}this.ctx.fill()}addPadStyle(e,t,n,i){this.mapStyles.set(e,new M(t,n,i))}addPad(e,t,n){this.mapPads.has(e)||this.mapPads.set(e,new Set);let i=this.mapPads.get(e);i&&(i.add(new I(e,t,n)),this.bb.update(t,n))}center(){k&&(this.mouseOffX=-this.bb.center()[0]*this.zoom+k.width/2,this.mouseOffY=-this.bb.center()[1]*this.zoom+k.height/2)}mouseDown(e){this.mouseStartX=e.clientX-this.mouseOffX,this.mouseStartY=e.clientY-this.mouseOffY,this.mouseFlag=!0}mouseUp(e){this.mouseFlag=!1}mouseMove(e){this.mouseFlag&&(this.mouseOffX=e.clientX-this.mouseStartX,this.mouseOffY=e.clientY-this.mouseStartY)}mouseWheel(e){e.deltaY>0?this.zoom*=1.1:this.zoom*=.9}}function W(){k&&P&&(window.requestAnimationFrame(W),P.clearRect(0,0,k.width,k.height),$.draw(P,k),Y.draw(),L&&L.draw())}function D(e){b&&x&&T&&w&&P&&C&&e.arrayBuffer().then((t=>{var n,i,o,s;n="UTF-8",i=t=>{x.innerHTML="",T.innerHTML="",O&&(O.innerText=e.name),async function(e){if(b&&x&&T&&w&&k&&P&&C){C.style.display="block",L=new R(P,k);const t=(e=e.replace(/\r/g,"")).split("\n");let n=1;for(let e of t)n++,await N(e),A&&(A.style.width=100*n/t.length+"%");L.center(),C.style.display="none"}}(t)},o=new Blob([t],{type:"text/plain"}),(s=new FileReader).onload=e=>{i(e.target.result)},s.readAsText(o,n)}))}async function N(e){return new Promise((t=>{if(b&&x&&T&&w&&P&&C){const t=e.match(/^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/);t&&(S=parseInt(t[1]),z=parseInt(t[2]),console.log(`gerber: float digits = ${S} ${z}`));const n=e.match(/^(%AD)(D[0-9]+)([A-Za-z])[,]([0-9.]+)[X]?([0-9.]+)?/);n&&(x.innerHTML+=`${n[2]} ${n[4]} ${n[5]}<br>`,L.addPadStyle(n[2],n[3],parseFloat(n[4]),parseFloat(n[5])),console.log(`gerber: style ${n[2]},${n[3]}, ${parseFloat(n[4])}, ${parseFloat(n[5])}`));const i=e.match(/^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/),o=e.match(/^(D[0-9]+)[*]/);if(o&&(F=o[1]),i){let e=i[2],t=i[4];const n=S+z;for(;e.length<n;)e=`0${e}`;for(;t.length<n;)t=`0${t}`;let o=0,s=0;e=`${e.substring(0,S)}.${e.substring(S)}`,t=`${t.substring(0,S)}.${t.substring(S)}`,o=parseFloat(e),s=parseFloat(t),"-"==i[1]&&(o*=-1),"-"==i[3]&&(s*=-1),T.innerHTML+=`${F}:  x:${o} y:${s} <br>`,L.addPad(F,o,s)}}setTimeout(t,0)}))}document.addEventListener("DOMContentLoaded",(function(){console.log("moinsen"),b&&x&&T&&w&&k?(P=k.getContext("2d"),k.addEventListener("mousemove",(e=>{L&&L.mouseMove(e)}),!1),k.addEventListener("mousedown",(e=>{L&&L.mouseDown(e)}),!1),k.addEventListener("mouseup",(e=>{L&&L.mouseUp(e)}),!1),k.addEventListener("mouseout",(e=>{L&&L.mouseUp(e)}),!1),k.addEventListener("wheel",(e=>{L&&L.mouseWheel(e)}),!1),b.onclick=()=>{var e=document.createElement("input");return e.type="file",e.click(),e.addEventListener("change",(t=>{if(console.log(t),e.files&&e.files.length>0){let t=e.files[0];console.log(t),console.log(`file: ${t.name} size:${t.size}`),D(t)}else alert("please choose a file")})),!1},w.ondrop=e=>{e.preventDefault(),console.log(e),e.dataTransfer.items?[...e.dataTransfer.items].forEach(((e,t)=>{if("file"===e.kind){const n=e.getAsFile();n&&(console.log(`… item[${t}].name = ${n.name}`),D(n))}})):[...e.dataTransfer.files].forEach(((e,t)=>{e&&(console.log(`… file[${t}].name = ${e.name}`),D(e))}))},w.ondragover=e=>{console.log("File(s) in drop zone"),e.preventDefault()},k.width=innerWidth,k.height=innerHeight-E.getBoundingClientRect().height-X.getBoundingClientRect().height-7,Y=new(0,e.Mouse)(P,k),Y.track(),$=new(0,e.Grid),window.requestAnimationFrame(W)):console.error("missing html elements !")})),window.addEventListener("resize",(e=>{console.log(`resize: ${e}`),k&&E&&X&&(k.width=innerWidth,k.height=innerHeight-E.getBoundingClientRect().height-X.getBoundingClientRect().height-7,Y.draw(),$.draw(P,k))}));
//# sourceMappingURL=index.23ad8bf5.js.map
