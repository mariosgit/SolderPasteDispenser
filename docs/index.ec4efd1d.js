var t={};!function(){var e={};function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"16px Monospace",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,t),this.x=r,this.y=l,this.ctx=e,this.canvas=i,this.color=s,this.font=o,this.setPos=this.setPos.bind(this)}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(t,[{key:"track",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.canvas;return t?e.addEventListener("mousemove",this.setPos):e.removeEventListener("mousemove",this.setPos),this}},{key:"setPos",value:function(t){var e=this.canvas.getBoundingClientRect();return this.x=Math.floor(t.clientX-e.left),this.y=Math.floor(t.clientY-e.top),this}},{key:"draw",value:function(){var t=this.x,e=this.y,n=this.canvas,i=this.ctx,s=this.font,o=this.color,r="X: ".concat(t,", Y: ").concat(e);i.save(),i.fillStyle=o,i.font=s;var l=t<n.width/2?20:-i.measureText(r).width-20,h=e<n.height/2?25:-18;return i.fillText(r,this.x+l,this.y+h),i.restore(),this}}]),t}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var h=function(){function t(e,n,i,s,r,l){o(this,t),this.color=e,this.lineWidth=n,this.startX=i,this.startY=s,this.endX=r,this.endY=l}return l(t,[{key:"draw",value:function(t){var e=this.color,n=this.lineWidth,i=this.startX,s=this.startY,o=this.endX,r=this.endY;t.save(),t.beginPath(),t.strokeStyle=e,t.lineWidth=n,t.moveTo(i,s),t.lineTo(o,r),t.stroke(),t.restore()}}]),t}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gray",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DarkGray",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"16px Monospace";o(this,t),this.color=e,this.lineWidth=n,this.step=i,this.boldNth=s,this.boldColor=r,this.boldWidth=l,this.font=h,this.lines=null}return l(t,[{key:"createLines",value:function(t){for(var e=this.color,n=this.lineWidth,i=this.step,s=this.boldNth,o=this.boldColor,r=this.boldWidth,l=[],a=s*i,c=0;c<t.width;c+=i){var u=c%a==0;l.push(u?new h(o,r,c,0,c,t.height):new h(e,n,c,0,c,t.height))}for(var d=0;d<t.height;d+=i){var m=d%a==0;l.push(m?new h(o,r,0,d,t.width,d):new h(e,n,0,d,t.width,d))}this.lines=l}},{key:"drawText",value:function(t,e){var n=this.step,i=this.boldNth,s=this.boldColor,o=this.font;t.save(),t.font=o,t.fillStyle=s,t.fillText("0",1,15);for(var r=n*i;r<e.width;r+=n*i)t.fillText(r,r,15);for(var l=n*i;l<e.height;l+=n*i)t.fillText(l,0,l+15);t.restore()}},{key:"draw",value:function(t,e){this.lines||this.createLines(e),this.lines.forEach((function(e){return e.draw(t)})),this.drawText(t,e)}}]),t}();e.Mouse=s,e.Grid=a,t=e}();class e{inputQueue=[];inputLast="";constructor(){this.deviceCheck=document.getElementById("deviceCheck"),this.deviceConnect=document.getElementById("deviceConnect"),this.deviceDisconnect=document.getElementById("deviceDisconnect"),this.deviceDosome=document.getElementById("deviceDosome"),this.deviceInput=document.getElementById("deviceInput"),this.deviceInputForm=document.getElementById("deviceInputForm"),this.deviceLog=document.getElementById("deviceLog"),this.port=null,this.textDecoder=new TextDecoderStream,this.deviceCheck&&this.deviceConnect&&this.deviceDisconnect&&this.deviceDosome&&this.deviceInput&&this.deviceInputForm&&(this.deviceCheck.onclick=this.serialCheck.bind(this),this.deviceConnect.onclick=this.serialConnect.bind(this),this.deviceDisconnect.onclick=this.serialDisconnect.bind(this),this.deviceDosome.onclick=this.serialDosome.bind(this),this.deviceInputForm.onsubmit=this.serialInputForm.bind(this)),this.serialCheck()}async serialCheck(){let t=!1;return"serial"in navigator?(this.updatePorts(),navigator.serial.addEventListener("connect",(t=>{console.log(t),this.updatePorts()})),navigator.serial.addEventListener("disconnect",(t=>{console.log(t)})),t=!0):console.warn("No serial API available, try onother browser"),t}updatePorts(){navigator.serial.getPorts().then((t=>{for(let e of t){const{usbProductId:t,usbVendorId:n}=e.getInfo();console.log(`updatePorts port pid:${t} vid:${n}`)}}))}serialError(t){this.deviceLog&&(this.deviceLog.innerHTML+=`<span class="w3-red">${t}</span>`)}onSerialConnected(){console.log("Device: onSerialConnected")}onSerialDisconnected(){console.log("Device: onSerialDisconnected")}async serialConnect(){this.port=await navigator.serial.requestPort(),await this.port.open({baudRate:25e4}).then((t=>{console.log("port opened ? ",this.port),this.deviceLog&&(this.deviceLog.innerHTML="connected<br>"),this.port.onconnect=()=>{console.log("CONNECTED")},this.port.ondisconnect=()=>{console.log("DISCONNECTED"),this.onSerialDisconnected()},setTimeout(this.serialRead.bind(this),0),this.onSerialConnected()})).catch((t=>{console.warn(t),this.serialError(t.toString())}))}async serialRead(){if(this.port){this.port.readable.pipeTo(this.textDecoder.writable);this.reader=this.textDecoder.readable.getReader(),setTimeout(this.serialReadon.bind(this),1)}}async serialReadon(){try{const{value:t,done:e}=await this.reader.read();if(e)this.reader.releaseLock(),console.log("serialRead - done");else{let e=!1;if(-1!=t.indexOf("\n")){const n=t.split("\n");n.length<=1&&console.error("Assertion failed ",n);for(let t=0;t<n.length-1;t++)this.inputLast+=n[t],this.inputQueue.push(this.inputLast),this.inputLast="",e=!0;this.inputLast=n[n.length-1]}else this.inputLast+=t;e&&setTimeout(this.serialCallback.bind(this),5),setTimeout(this.serialReadon.bind(this),1)}}catch(t){console.warn(t),this.serialError(t.toString())}}serialCallback(){const t=document.getElementById("deviceLog");if(t){let e=this.inputQueue.pop();for(;e;)t.innerHTML+=`${e}<br>`,e=this.inputQueue.pop()}}async serialWrite(t){let e=new TextEncoder;const n=this.port.writable.getWriter();await n.write(e.encode(`${t}\n`)),n.releaseLock()}async serialDisconnect(){this.port&&this.port.close().then((()=>{this.port=null,console.log("port closed")})).catch((t=>{console.warn(t)}))}async serialDosome(){let t=new TextEncoder;const e=this.port.writable.getWriter();await e.write(t.encode("hiho\n")),e.releaseLock()}async serialInputForm(t){this.deviceInput&&(t.preventDefault(),this.serialInputChange(t))}async serialInputChange(t){if(this.deviceInput)if(this.port){let t=this.deviceInput.value;if(t.length>0){let e=new TextEncoder;const n=this.port.writable.getWriter();await n.write(e.encode(`${t}\n`)),n.releaseLock()}}else console.warn("serialInputChange - no port open")}}var n,i={};
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */n=function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var i=this.content.pop();return void(n!=e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e,this.content[t]=i,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var s=2*(t+1),o=s-1,r=null;if(o<e){var l=this.content[o],h=this.scoreFunction(l);h<i&&(r=o)}if(s<e){var a=this.content[s];this.scoreFunction(a)<(null==r?i:h)&&(r=s)}if(null==r)break;this.content[t]=this.content[r],this.content[r]=n,t=r}}},t.kdTree=function(t,i,s){var o=this;Array.isArray(t)?this.root=function t(n,i,o){var r,l,h=i%s.length;return 0===n.length?null:1===n.length?new e(n[0],h,o):(n.sort((function(t,e){return t[s[h]]-e[s[h]]})),(l=new e(n[r=Math.floor(n.length/2)],h,o)).left=t(n.slice(0,r),i+1,l),l.right=t(n.slice(r+1),i+1,l),l)}(t,0,null):function(t){o.root=t,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(o.root)}(t),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=o.toJSON(t.left)),t.right&&(n.right=o.toJSON(t.right)),n},this.insert=function(t){var n,i,o=function e(n,i){if(null===n)return i;var o=s[n.dimension];return t[o]<n.obj[o]?e(n.left,n):e(n.right,n)}(this.root,null);null!==o?(n=new e(t,(o.dimension+1)%s.length,o),i=s[o.dimension],t[i]<o.obj[i]?o.left=n:o.right=n):this.root=new e(t,0,null)},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var i=s[n.dimension];return t[i]<n.obj[i]?e(n.left):e(n.right)}(o.root))&&function t(e){function n(t,e){var i,o,r,l,h;return null===t?null:(i=s[e],t.dimension===e?null!==t.left?n(t.left,e):t:(o=t.obj[i],r=n(t.left,e),l=n(t.right,e),h=t,null!==r&&r.obj[i]<o&&(h=r),null!==l&&l.obj[i]<h.obj[i]&&(h=l),h))}var i,r,l;if(null===e.left&&null===e.right)return null===e.parent?void(o.root=null):(l=s[e.parent.dimension],void(e.obj[l]<e.parent.obj[l]?e.parent.left=null:e.parent.right=null));null!==e.right?(r=(i=n(e.right,e.dimension)).obj,t(i),e.obj=r):(r=(i=n(e.left,e.dimension)).obj,t(i),e.right=e.left,e.left=null,e.obj=r)}(e)},this.nearest=function(t,e,r){var l,h,a;if(a=new n((function(t){return-t[1]})),r)for(l=0;l<e;l+=1)a.push([null,r]);for(o.root&&function n(o){function r(t,n){a.push([t,n]),a.size()>e&&a.pop()}var l,h,c,u,d=s[o.dimension],m=i(t,o.obj),f={};for(u=0;u<s.length;u+=1)u===o.dimension?f[s[u]]=t[s[u]]:f[s[u]]=o.obj[s[u]];h=i(f,o.obj),null!==o.right||null!==o.left?(n(l=null===o.right?o.left:null===o.left?o.right:t[d]<o.obj[d]?o.left:o.right),(a.size()<e||m<a.peek()[1])&&r(o,m),(a.size()<e||Math.abs(h)<a.peek()[1])&&null!==(c=l===o.left?o.right:o.left)&&n(c)):(a.size()<e||m<a.peek()[1])&&r(o,m)}(o.root),h=[],l=0;l<Math.min(e,a.content.length);l+=1)a.content[l][0]&&h.push([a.content[l][0].obj,a.content[l][1]]);return h},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(o.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(o.root))/Math.log(2))}},t.BinaryHeap=n},"function"==typeof define&&define.amd?define(["exports"],n):n(i);class s{minx=99999;miny=99999;maxx=-99999;maxy=-99999;constructor(){}update(t,e){t<this.minx&&(this.minx=t),e<this.miny&&(this.miny=e),t>this.maxx&&(this.maxx=t),e>this.maxy&&(this.maxy=e)}center(t=1){return[(this.minx+(this.maxx-this.minx)/2)*t,(this.miny+(this.maxy-this.miny)/2)*t]}zero(t=1){return[this.minx*t,this.miny*t]}size(t=1){return[(this.maxx-this.minx)*t,(this.maxy-this.miny)*t]}}class o{constructor(t,e,n){this.form=t,this.width=e,this.height=n}}class r{constructor(t,e,n){this.posX=e,this.posY=n,this.style=t}}class l{fileName="";mouseFlag=!1;mouseStartX=0;mouseStartY=0;mouseOffX=0;mouseOffY=0;zoom=6;nearest=[];constructor(t,e){this.ctx=t,this.canvas=e,this.mapStyles=new Map,this.mapPads=new Map,this.bb=new s}draw(){this.ctx.fillStyle="antiquewhite",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.moveTo(-10+this.mouseOffX,0+this.mouseOffY),this.ctx.lineTo(10+this.mouseOffX,0+this.mouseOffY),this.ctx.moveTo(0+this.mouseOffX,-10+this.mouseOffY),this.ctx.lineTo(0+this.mouseOffX,10+this.mouseOffY),this.ctx.stroke(),this.ctx.strokeStyle="red";let t=this.bb.center(this.zoom);this.ctx.beginPath(),this.ctx.moveTo(t[0]-10+this.mouseOffX,t[1]+this.mouseOffY),this.ctx.lineTo(t[0]+10+this.mouseOffX,t[1]+this.mouseOffY),this.ctx.moveTo(t[0]+this.mouseOffX,t[1]-10+this.mouseOffY),this.ctx.lineTo(t[0]+this.mouseOffX,t[1]+10+this.mouseOffY),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.bb.zero(this.zoom)[0]+this.mouseOffX,this.bb.zero(this.zoom)[1]+this.mouseOffY,this.bb.size(this.zoom)[0],this.bb.size(this.zoom)[1]),this.ctx.stroke();for(let t of this.mapPads.keys()){const e=this.mapStyles.get(t),n=this.mapPads.get(t);if(e&&n){const t=e.width*this.zoom,i=e.height*this.zoom;for(let s of n.values())if("R"==e.form||"O"==e.form||"RoundRect"==e.form)this.ctx.beginPath(),this.ctx.fillRect(s.posX*this.zoom-t/2+this.mouseOffX,s.posY*this.zoom-i/2+this.mouseOffY,t,i),this.ctx.fill();else{if("C"!=e.form){console.log(`draw quatsch ${e.form}`);break}this.ctx.beginPath(),this.ctx.ellipse(s.posX*this.zoom+this.mouseOffX,s.posY*this.zoom+this.mouseOffY,t/2,t/2,0,0,2*Math.PI),this.ctx.fill()}}}this.ctx.strokeStyle="purple",this.ctx.beginPath();for(const t of this.nearest)this.ctx.moveTo((t[0].posX-5)*this.zoom+this.mouseOffX,t[0].posY*this.zoom+this.mouseOffY),this.ctx.lineTo((t[0].posX+5)*this.zoom+this.mouseOffX,t[0].posY*this.zoom+this.mouseOffY),this.ctx.moveTo(t[0].posX*this.zoom+this.mouseOffX,(t[0].posY+5)*this.zoom+this.mouseOffY),this.ctx.lineTo(t[0].posX*this.zoom+this.mouseOffX,(t[0].posY-5)*this.zoom+this.mouseOffY);this.ctx.stroke()}addPadStyle(t,e,n,i){this.mapStyles.set(t,new o(e,n,i))}addPad(t,e,n){this.mapPads.has(t)||this.mapPads.set(t,new Set);let i=this.mapPads.get(t);if(i){const s=new r(t,e,n);i.add(s),this.bb.update(e,n)}}center(){this.canvas&&(this.mouseOffX=-this.bb.center()[0]*this.zoom+this.canvas.width/2,this.mouseOffY=-this.bb.center()[1]*this.zoom+this.canvas.height/2)}retree(){try{let t=[];for(let e of this.mapPads.values())for(let n of e)t.push(n);this.tree=new(0,i.kdTree)(t,l.distance,["posX","posY"]),console.log("tree bf:",this.tree.balanceFactor())}catch(t){console.error(t)}}mouseDown(t){const e=this.ctx.getTransform();console.log(e),this.mouseStartX=t.clientX*e.a-this.mouseOffX,this.mouseStartY=t.clientY*e.d-this.mouseOffY,this.mouseFlag=!0}mouseUp(t){this.mouseFlag=!1;const e=this.ctx.getTransform();console.log(e,t),console.log("",this.canvas.height-(t.clientY-this.canvas.offsetTop),this.mouseOffY);const n=(t.clientX*e.a-this.mouseOffX)/this.zoom,i=(this.canvas.height-(t.clientY-this.canvas.offsetTop)-this.mouseOffY)/this.zoom;if(this.tree){this.nearest=this.tree.nearest({posX:n,posY:i},1);for(const t of this.nearest)console.log(`m:${n},${i} nearest:${t[0].posX},${t[0].posY}  dist:${Math.sqrt(t[1])}`)}}mouseMove(t){const e=this.ctx.getTransform();this.mouseFlag&&(this.mouseOffX=t.clientX*e.a-this.mouseStartX,this.mouseOffY=t.clientY*e.d-this.mouseStartY)}mouseWheel(t){t.deltaY>0?this.zoom*=1.1:this.zoom*=.9}static distance(t,e){return Math.pow(t.posX-e.posX,2)+Math.pow(t.posY-e.posY,2)}}const h=document.getElementsByTagName("body")[0],a=document.getElementById("uploadButton"),c=document.getElementById("padsField"),u=document.getElementById("coordsField"),d=document.getElementById("dropZone"),m=document.getElementById("canvas"),f=document.getElementById("progress"),g=document.getElementById("progressbar"),p=document.getElementById("progressCancel"),v=document.getElementsByTagName("header")[0],b=document.getElementsByTagName("footer")[0];let w,y,x,E=null,k=1,B=1,T="",Y=!1;const X=/^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/,D=/^(%AD)(D[0-9]+)([A-Za-z]+)[,]([-0-9.]+)[X]?([-0-9.]+)?[X]?([-0-9.]+)?/,M=/^([DG][0-9]+)[*]/,P=/^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/;new class extends e{constructor(){if(super(),this.marlinDiv=document.getElementById("Marlin"),console.log("hallo"),this.marlinDiv){this.marlinDiv.innerHTML='\n            <div id="marlinStatus"></div>\n            <div >\n            <button id="marlinHome" class="w3-button w3-grey">home</button>\n            <button id="marlinPos" class="w3-button w3-grey">pos?</button>\n            <button id="marlinRel" class="w3-button w3-grey">rel</button>\n            <button id="marlinCold" class="w3-button w3-grey">cold</button>\n            <br>\n            <button id="marlinXP" class="w3-button w3-grey">x+</button>\n            <button id="marlinXM" class="w3-button w3-grey">x-</button>\n            <button id="marlinYP" class="w3-button w3-grey">y+</button>\n            <button id="marlinYM" class="w3-button w3-grey">y-</button>\n            <button id="marlinZP" class="w3-button w3-grey">z+</button>\n            <button id="marlinZM" class="w3-button w3-grey">z-</button>\n            <button id="marlinEP" class="w3-button w3-grey">e+</button>\n            <button id="marlinEM" class="w3-button w3-grey">e-</button>\n            </div>\n            ',this.marlinDivStatus=document.getElementById("marlinStatus"),this.marlinDivStatus&&(this.marlinDivStatus.innerHTML='Status: <span class="w3-badge w3-grey">💭</span> horst');const t=document.getElementById("marlinHome");t&&(t.onclick=this.onBtnHome.bind(this));const e=document.getElementById("marlinPos");e&&(e.onclick=this.onBtnPos.bind(this));const n=document.getElementById("marlinRel");n&&(n.onclick=this.onBtnRel.bind(this));const i=document.getElementById("marlinCold");i&&(i.onclick=this.onBtnCold.bind(this));const s=document.getElementById("marlinXP");s&&(s.onclick=this.onBtnXP.bind(this));const o=document.getElementById("marlinXM");o&&(o.onclick=this.onBtnXM.bind(this));const r=document.getElementById("marlinYP");r&&(r.onclick=this.onBtnYP.bind(this));const l=document.getElementById("marlinYM");l&&(l.onclick=this.onBtnYM.bind(this));const h=document.getElementById("marlinZP");h&&(h.onclick=this.onBtnZP.bind(this));const a=document.getElementById("marlinZM");a&&(a.onclick=this.onBtnZM.bind(this));const c=document.getElementById("marlinEP");c&&(c.onclick=this.onBtnEP.bind(this));const u=document.getElementById("marlinEM");u&&(u.onclick=this.onBtnEM.bind(this))}}onSerialConnected(){console.log("Marlin: onSerialConnected"),this.marlinDivStatus&&(this.marlinDivStatus.innerHTML='Status: <span class="w3-badge w3-grey">👍</span>')}onSerialDisconnected(){console.log("Marlin: onSerialDisconnected"),this.marlinDivStatus&&(this.marlinDivStatus.innerHTML='Status: <span class="w3-badge w3-grey">👎</span>')}onBtnHome(){this.serialWrite("G28")}onBtnPos(){this.serialWrite("M114")}onBtnRel(){this.serialWrite("G91")}onBtnCold(){this.serialWrite("M302 S0")}onBtnXP(){this.serialWrite("G0 X10")}onBtnXM(){this.serialWrite("G0 X-10")}onBtnYP(){this.serialWrite("G0 Y10")}onBtnYM(){this.serialWrite("G0 Y-10")}onBtnZP(){this.serialWrite("G0 Z10")}onBtnZM(){this.serialWrite("G0 Z-10")}onBtnEP(){this.serialWrite("G0 E10")}onBtnEM(){this.serialWrite("G0 E-10")}};function I(){m&&E&&(window.requestAnimationFrame(I),E.setTransform(1,0,0,-1,0,m.height),E.clearRect(0,0,m.width,m.height),y.draw(E,m),w.draw(),x&&x.draw())}function O(t){a&&c&&u&&h&&E&&f&&t.arrayBuffer().then((e=>{var n,i,s,o;n="UTF-8",i=e=>{c.innerHTML="",u.innerHTML="",d&&(d.innerText=t.name),async function(t){if(a&&c&&u&&h&&m&&E&&f){f.style.display="block",x=new l(E,m);const e=(t=t.replace(/\r/g,"")).split("\n");let n=1;for(let t of e){if(n++,Y){Y=!1;break}await S(t),g&&(g.style.width=100*n/e.length+"%")}x.retree(),f.style.display="none"}}(e)},s=new Blob([e],{type:"text/plain"}),(o=new FileReader).onload=t=>{i(t.target.result)},o.readAsText(s,n)}))}async function S(t){return new Promise((e=>{if(a&&c&&u&&h&&E&&f){const e=X.exec(t);e&&(B=parseInt(e[1]),k=parseInt(e[2]),console.log(`gerber: float digits = ${B} ${k}`));const n=D.exec(t);n&&(c.innerHTML+=`${n[2]} ${n[3]} ${n[4]} ${n[5]}<br>`,"RoundRect"==n[3]?x.addPadStyle(n[2],n[3],Math.abs(parseFloat(n[5])),Math.abs(parseFloat(n[6]))):x.addPadStyle(n[2],n[3],parseFloat(n[4]),parseFloat(n[5])));const i=M.exec(t);i&&(T=i[1]);const s=P.exec(t);if(s)if(T.startsWith("D")){let t=s[2],e=s[4];const n=B+k;for(;t.length<n;)t=`0${t}`;for(;e.length<n;)e=`0${e}`;let i=0,o=0;t=`${t.substring(0,B)}.${t.substring(B)}`,e=`${e.substring(0,B)}.${e.substring(B)}`,i=parseFloat(t),o=parseFloat(e),"-"==s[1]&&(i*=-1),"-"==s[3]&&(o*=-1),u.innerHTML+=`${T}:  x:${i} y:${o} <br>`,x.addPad(T,i,o)}else console.log(`ignoring ${T}`)}x.center(),setTimeout(e,0)}))}globalThis.accordionToggler=t=>{var e=document.getElementById(t);e?-1==e.className.indexOf("w3-show")&&-1==e.className.indexOf("w3-hide")?e.className+=" w3-show":-1!=e.className.indexOf("w3-show")?e.className=e.className.replace("w3-show","w3-hide"):e.className=e.className.replace("w3-hide","w3-show"):console.warn("accordionToggler no elem with id:",t)},document.addEventListener("DOMContentLoaded",(function(){console.log("moinsen"),a&&p&&c&&u&&h&&m?(E=m.getContext("2d"),m.addEventListener("mousemove",(t=>{x&&x.mouseMove(t),t.preventDefault()}),!1),m.addEventListener("mousedown",(t=>{x&&x.mouseDown(t),t.preventDefault()}),!1),m.addEventListener("mouseup",(t=>{x&&x.mouseUp(t),t.preventDefault()}),!1),m.addEventListener("mouseout",(t=>{x&&x.mouseUp(t),t.preventDefault()}),!1),m.addEventListener("wheel",(t=>{x&&x.mouseWheel(t),t.preventDefault()}),!1),a.onclick=()=>{var t=document.createElement("input");return t.type="file",t.click(),t.addEventListener("change",(e=>{if(console.log(e),t.files&&t.files.length>0){let e=t.files[0];console.log(e),console.log(`file: ${e.name} size:${e.size}`),O(e)}else alert("please choose a file")})),!1},p.onclick=()=>{Y=!0},h.ondrop=t=>{t.preventDefault(),console.log(t),t.dataTransfer.items?[...t.dataTransfer.items].forEach(((t,e)=>{if("file"===t.kind){const n=t.getAsFile();n&&(console.log(`… item[${e}].name = ${n.name}`),O(n))}})):[...t.dataTransfer.files].forEach(((t,e)=>{t&&(console.log(`… file[${e}].name = ${t.name}`),O(t))}))},h.ondragover=t=>{console.log("File(s) in drop zone"),t.preventDefault()},m.width=innerWidth,m.height=innerHeight-v.getBoundingClientRect().height-b.getBoundingClientRect().height-7,w=new(0,t.Mouse)(E,m),w.track(),y=new(0,t.Grid),window.requestAnimationFrame(I)):console.error("missing html elements !")})),window.addEventListener("resize",(t=>{console.log(`resize: ${t}`),m&&v&&b&&(m.width=innerWidth,m.height=innerHeight-v.getBoundingClientRect().height-b.getBoundingClientRect().height-7,w.draw(),y.draw(E,m))}));
//# sourceMappingURL=index.ec4efd1d.js.map
