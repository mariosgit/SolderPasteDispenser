var t={};!function(){var e={};function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"16px Monospace",h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,t),this.x=h,this.y=r,this.ctx=e,this.canvas=o,this.color=i,this.font=s,this.setPos=this.setPos.bind(this)}return function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(t,[{key:"track",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.canvas;return t?e.addEventListener("mousemove",this.setPos):e.removeEventListener("mousemove",this.setPos),this}},{key:"setPos",value:function(t){var e=this.canvas.getBoundingClientRect();return this.x=Math.floor(t.clientX-e.left),this.y=Math.floor(t.clientY-e.top),this}},{key:"draw",value:function(){var t=this.x,e=this.y,n=this.canvas,o=this.ctx,i=this.font,s=this.color,h="X: ".concat(t,", Y: ").concat(e);o.save(),o.fillStyle=s,o.font=i;var r=t<n.width/2?20:-o.measureText(h).width-20,l=e<n.height/2?25:-18;return o.fillText(h,this.x+r,this.y+l),o.restore(),this}}]),t}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}var l=function(){function t(e,n,o,i,h,r){s(this,t),this.color=e,this.lineWidth=n,this.startX=o,this.startY=i,this.endX=h,this.endY=r}return r(t,[{key:"draw",value:function(t){var e=this.color,n=this.lineWidth,o=this.startX,i=this.startY,s=this.endX,h=this.endY;t.save(),t.beginPath(),t.strokeStyle=e,t.lineWidth=n,t.moveTo(o,i),t.lineTo(s,h),t.stroke(),t.restore()}}]),t}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gray",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DarkGray",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"16px Monospace";s(this,t),this.color=e,this.lineWidth=n,this.step=o,this.boldNth=i,this.boldColor=h,this.boldWidth=r,this.font=l,this.lines=null}return r(t,[{key:"createLines",value:function(t){for(var e=this.color,n=this.lineWidth,o=this.step,i=this.boldNth,s=this.boldColor,h=this.boldWidth,r=[],a=i*o,c=0;c<t.width;c+=o){var f=c%a==0;r.push(f?new l(s,h,c,0,c,t.height):new l(e,n,c,0,c,t.height))}for(var u=0;u<t.height;u+=o){var m=u%a==0;r.push(m?new l(s,h,0,u,t.width,u):new l(e,n,0,u,t.width,u))}this.lines=r}},{key:"drawText",value:function(t,e){var n=this.step,o=this.boldNth,i=this.boldColor,s=this.font;t.save(),t.font=s,t.fillStyle=i,t.fillText("0",1,15);for(var h=n*o;h<e.width;h+=n*o)t.fillText(h,h,15);for(var r=n*o;r<e.height;r+=n*o)t.fillText(r,0,r+15);t.restore()}},{key:"draw",value:function(t,e){this.lines||this.createLines(e),this.lines.forEach((function(e){return e.draw(t)})),this.drawText(t,e)}}]),t}();e.Mouse=i,e.Grid=a,t=e}();var e,n={};
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */e=function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var o=this.content.pop();return void(n!=e-1&&(this.content[n]=o,this.scoreFunction(o)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,o=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(o)))break;this.content[n]=e,this.content[t]=o,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],o=this.scoreFunction(n);;){var i=2*(t+1),s=i-1,h=null;if(s<e){var r=this.content[s],l=this.scoreFunction(r);l<o&&(h=s)}if(i<e){var a=this.content[i];this.scoreFunction(a)<(null==h?o:l)&&(h=i)}if(null==h)break;this.content[t]=this.content[h],this.content[h]=n,t=h}}},t.kdTree=function(t,o,i){var s=this;Array.isArray(t)?this.root=function t(n,o,s){var h,r,l=o%i.length;return 0===n.length?null:1===n.length?new e(n[0],l,s):(n.sort((function(t,e){return t[i[l]]-e[i[l]]})),(r=new e(n[h=Math.floor(n.length/2)],l,s)).left=t(n.slice(0,h),o+1,r),r.right=t(n.slice(h+1),o+1,r),r)}(t,0,null):function(t){s.root=t,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(s.root)}(t),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=s.toJSON(t.left)),t.right&&(n.right=s.toJSON(t.right)),n},this.insert=function(t){var n,o,s=function e(n,o){if(null===n)return o;var s=i[n.dimension];return t[s]<n.obj[s]?e(n.left,n):e(n.right,n)}(this.root,null);null!==s?(n=new e(t,(s.dimension+1)%i.length,s),o=i[s.dimension],t[o]<s.obj[o]?s.left=n:s.right=n):this.root=new e(t,0,null)},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var o=i[n.dimension];return t[o]<n.obj[o]?e(n.left):e(n.right)}(s.root))&&function t(e){function n(t,e){var o,s,h,r,l;return null===t?null:(o=i[e],t.dimension===e?null!==t.left?n(t.left,e):t:(s=t.obj[o],h=n(t.left,e),r=n(t.right,e),l=t,null!==h&&h.obj[o]<s&&(l=h),null!==r&&r.obj[o]<l.obj[o]&&(l=r),l))}var o,h,r;if(null===e.left&&null===e.right)return null===e.parent?void(s.root=null):(r=i[e.parent.dimension],void(e.obj[r]<e.parent.obj[r]?e.parent.left=null:e.parent.right=null));null!==e.right?(h=(o=n(e.right,e.dimension)).obj,t(o),e.obj=h):(h=(o=n(e.left,e.dimension)).obj,t(o),e.right=e.left,e.left=null,e.obj=h)}(e)},this.nearest=function(t,e,h){var r,l,a;if(a=new n((function(t){return-t[1]})),h)for(r=0;r<e;r+=1)a.push([null,h]);for(s.root&&function n(s){function h(t,n){a.push([t,n]),a.size()>e&&a.pop()}var r,l,c,f,u=i[s.dimension],m=o(t,s.obj),d={};for(f=0;f<i.length;f+=1)f===s.dimension?d[i[f]]=t[i[f]]:d[i[f]]=s.obj[i[f]];l=o(d,s.obj),null!==s.right||null!==s.left?(n(r=null===s.right?s.left:null===s.left?s.right:t[u]<s.obj[u]?s.left:s.right),(a.size()<e||m<a.peek()[1])&&h(s,m),(a.size()<e||Math.abs(l)<a.peek()[1])&&null!==(c=r===s.left?s.right:s.left)&&n(c)):(a.size()<e||m<a.peek()[1])&&h(s,m)}(s.root),l=[],r=0;r<Math.min(e,a.content.length);r+=1)a.content[r][0]&&l.push([a.content[r][0].obj,a.content[r][1]]);return l},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(s.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(s.root))/Math.log(2))}},t.BinaryHeap=n},"function"==typeof define&&define.amd?define(["exports"],e):e(n);class o{minx=99999;miny=99999;maxx=-99999;maxy=-99999;constructor(){}update(t,e){t<this.minx&&(this.minx=t),e<this.miny&&(this.miny=e),t>this.maxx&&(this.maxx=t),e>this.maxy&&(this.maxy=e)}center(t=1){return[(this.minx+(this.maxx-this.minx)/2)*t,(this.miny+(this.maxy-this.miny)/2)*t]}zero(t=1){return[this.minx*t,this.miny*t]}size(t=1){return[(this.maxx-this.minx)*t,(this.maxy-this.miny)*t]}}class i{constructor(t,e,n){this.form=t,this.width=e,this.height=n}}class s{constructor(t,e,n){this.posX=e,this.posY=n,this.style=t}}class h{fileName="";mouseFlag=!1;mouseStartX=0;mouseStartY=0;mouseOffX=0;mouseOffY=0;zoom=6;nearest=[];constructor(t,e){this.ctx=t,this.canvas=e,this.mapStyles=new Map,this.mapPads=new Map,this.bb=new o}draw(){this.ctx.fillStyle="antiquewhite",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.moveTo(-10+this.mouseOffX,0+this.mouseOffY),this.ctx.lineTo(10+this.mouseOffX,0+this.mouseOffY),this.ctx.moveTo(0+this.mouseOffX,-10+this.mouseOffY),this.ctx.lineTo(0+this.mouseOffX,10+this.mouseOffY),this.ctx.stroke(),this.ctx.strokeStyle="red";let t=this.bb.center(this.zoom);this.ctx.beginPath(),this.ctx.moveTo(t[0]-10+this.mouseOffX,t[1]+this.mouseOffY),this.ctx.lineTo(t[0]+10+this.mouseOffX,t[1]+this.mouseOffY),this.ctx.moveTo(t[0]+this.mouseOffX,t[1]-10+this.mouseOffY),this.ctx.lineTo(t[0]+this.mouseOffX,t[1]+10+this.mouseOffY),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.bb.zero(this.zoom)[0]+this.mouseOffX,this.bb.zero(this.zoom)[1]+this.mouseOffY,this.bb.size(this.zoom)[0],this.bb.size(this.zoom)[1]),this.ctx.stroke();for(let t of this.mapPads.keys()){const e=this.mapStyles.get(t),n=this.mapPads.get(t);if(e&&n){const t=e.width*this.zoom,o=e.height*this.zoom;for(let i of n.values())if("R"==e.form||"O"==e.form||"RoundRect"==e.form)this.ctx.beginPath(),this.ctx.fillRect(i.posX*this.zoom-t/2+this.mouseOffX,i.posY*this.zoom-o/2+this.mouseOffY,t,o),this.ctx.fill();else{if("C"!=e.form){console.log(`draw quatsch ${e.form}`);break}this.ctx.beginPath(),this.ctx.ellipse(i.posX*this.zoom+this.mouseOffX,i.posY*this.zoom+this.mouseOffY,t/2,t/2,0,0,2*Math.PI),this.ctx.fill()}}}this.ctx.strokeStyle="purple",this.ctx.beginPath();for(const t of this.nearest)this.ctx.moveTo((t[0].posX-1)*this.zoom+this.mouseOffX,t[0].posY*this.zoom+this.mouseOffY),this.ctx.lineTo((t[0].posX+1)*this.zoom+this.mouseOffX,t[0].posY*this.zoom+this.mouseOffY),this.ctx.moveTo(t[0].posX*this.zoom+this.mouseOffX,(t[0].posY+1)*this.zoom+this.mouseOffY),this.ctx.lineTo(t[0].posX*this.zoom+this.mouseOffX,(t[0].posY-1)*this.zoom+this.mouseOffY);this.ctx.stroke()}addPadStyle(t,e,n,o){this.mapStyles.set(t,new i(e,n,o))}addPad(t,e,n){this.mapPads.has(t)||this.mapPads.set(t,new Set);let o=this.mapPads.get(t);if(o){const i=new s(t,e,n);o.add(i),this.bb.update(e,n)}}center(){this.canvas&&(this.mouseOffX=-this.bb.center()[0]*this.zoom+this.canvas.width/2,this.mouseOffY=-this.bb.center()[1]*this.zoom+this.canvas.height/2)}retree(){try{let t=[];for(let e of this.mapPads.values())for(let n of e)t.push(n);this.tree=new(0,n.kdTree)(t,h.distance,["posX","posY"]),console.log("tree bf:",this.tree.balanceFactor())}catch(t){console.error(t)}}mouseDown(t){const e=this.ctx.getTransform();console.log(e),this.mouseStartX=t.clientX*e.a-this.mouseOffX,this.mouseStartY=t.clientY*e.d-this.mouseOffY,this.mouseFlag=!0}mouseUp(t){this.mouseFlag=!1;const e=this.ctx.getTransform();console.log(e,t),console.log("",this.canvas.height-(t.clientY-this.canvas.offsetTop),this.mouseOffY);const n=(t.clientX*e.a-this.mouseOffX)/this.zoom,o=(this.canvas.height-(t.clientY-this.canvas.offsetTop)-this.mouseOffY)/this.zoom;if(this.tree){this.nearest=this.tree.nearest({posX:n,posY:o},1);for(const t of this.nearest)console.log(`m:${n},${o} nearest:${t[0].posX},${t[0].posY}  dist:${Math.sqrt(t[1])}`)}}mouseMove(t){const e=this.ctx.getTransform();this.mouseFlag&&(this.mouseOffX=t.clientX*e.a-this.mouseStartX,this.mouseOffY=t.clientY*e.d-this.mouseStartY)}mouseWheel(t){t.deltaY>0?this.zoom*=1.1:this.zoom*=.9}static distance(t,e){return Math.pow(t.posX-e.posX,2)+Math.pow(t.posY-e.posY,2)}}const r=document.getElementsByTagName("body")[0],l=document.getElementById("uploadButton"),a=document.getElementById("padsField"),c=document.getElementById("coordsField"),f=document.getElementById("dropZone"),u=document.getElementById("canvas"),m=document.getElementById("progress"),d=document.getElementById("progressbar"),g=document.getElementById("progressCancel"),p=document.getElementsByTagName("header")[0],v=document.getElementsByTagName("footer")[0];let b,x,w,y=null,O=1,Y=1,X="",T=!1;const z=/^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/,k=/^(%AD)(D[0-9]+)([A-Za-z]+)[,]([-0-9.]+)[X]?([-0-9.]+)?[X]?([-0-9.]+)?/,E=/^([DG][0-9]+)[*]/,F=/^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/;function $(){u&&y&&(window.requestAnimationFrame($),y.setTransform(1,0,0,-1,0,u.height),y.clearRect(0,0,u.width,u.height),x.draw(y,u),b.draw(),w&&w.draw())}function M(t){l&&a&&c&&r&&y&&m&&t.arrayBuffer().then((e=>{var n,o,i,s;n="UTF-8",o=e=>{a.innerHTML="",c.innerHTML="",f&&(f.innerText=t.name),async function(t){if(l&&a&&c&&r&&u&&y&&m){m.style.display="block",w=new h(y,u);const e=(t=t.replace(/\r/g,"")).split("\n");let n=1;for(let t of e){if(n++,T){T=!1;break}await P(t),d&&(d.style.width=100*n/e.length+"%")}w.retree(),m.style.display="none"}}(e)},i=new Blob([e],{type:"text/plain"}),(s=new FileReader).onload=t=>{o(t.target.result)},s.readAsText(i,n)}))}async function P(t){return new Promise((e=>{if(l&&a&&c&&r&&y&&m){const e=z.exec(t);e&&(Y=parseInt(e[1]),O=parseInt(e[2]),console.log(`gerber: float digits = ${Y} ${O}`));const n=k.exec(t);n&&(a.innerHTML+=`${n[2]} ${n[3]} ${n[4]} ${n[5]}<br>`,"RoundRect"==n[3]?w.addPadStyle(n[2],n[3],Math.abs(parseFloat(n[5])),Math.abs(parseFloat(n[6]))):w.addPadStyle(n[2],n[3],parseFloat(n[4]),parseFloat(n[5])));const o=E.exec(t);o&&(X=o[1]);const i=F.exec(t);if(i)if(X.startsWith("D")){let t=i[2],e=i[4];const n=Y+O;for(;t.length<n;)t=`0${t}`;for(;e.length<n;)e=`0${e}`;let o=0,s=0;t=`${t.substring(0,Y)}.${t.substring(Y)}`,e=`${e.substring(0,Y)}.${e.substring(Y)}`,o=parseFloat(t),s=parseFloat(e),"-"==i[1]&&(o*=-1),"-"==i[3]&&(s*=-1),c.innerHTML+=`${X}:  x:${o} y:${s} <br>`,w.addPad(X,o,s)}else console.log(`ignoring ${X}`)}w.center(),setTimeout(e,0)}))}globalThis.accordionToggler=t=>{var e=document.getElementById(t);e&&(-1==e.className.indexOf("w3-show")?e.className+=" w3-show":e.className=e.className.replace(" w3-show",""))},document.addEventListener("DOMContentLoaded",(function(){console.log("moinsen"),l&&g&&a&&c&&r&&u?(y=u.getContext("2d"),u.addEventListener("mousemove",(t=>{w&&w.mouseMove(t),t.preventDefault()}),!1),u.addEventListener("mousedown",(t=>{w&&w.mouseDown(t),t.preventDefault()}),!1),u.addEventListener("mouseup",(t=>{w&&w.mouseUp(t),t.preventDefault()}),!1),u.addEventListener("mouseout",(t=>{w&&w.mouseUp(t),t.preventDefault()}),!1),u.addEventListener("wheel",(t=>{w&&w.mouseWheel(t),t.preventDefault()}),!1),l.onclick=()=>{var t=document.createElement("input");return t.type="file",t.click(),t.addEventListener("change",(e=>{if(console.log(e),t.files&&t.files.length>0){let e=t.files[0];console.log(e),console.log(`file: ${e.name} size:${e.size}`),M(e)}else alert("please choose a file")})),!1},g.onclick=()=>{T=!0},r.ondrop=t=>{t.preventDefault(),console.log(t),t.dataTransfer.items?[...t.dataTransfer.items].forEach(((t,e)=>{if("file"===t.kind){const n=t.getAsFile();n&&(console.log(`… item[${e}].name = ${n.name}`),M(n))}})):[...t.dataTransfer.files].forEach(((t,e)=>{t&&(console.log(`… file[${e}].name = ${t.name}`),M(t))}))},r.ondragover=t=>{console.log("File(s) in drop zone"),t.preventDefault()},u.width=innerWidth,u.height=innerHeight-p.getBoundingClientRect().height-v.getBoundingClientRect().height-7,b=new(0,t.Mouse)(y,u),b.track(),x=new(0,t.Grid),window.requestAnimationFrame($)):console.error("missing html elements !")})),window.addEventListener("resize",(t=>{console.log(`resize: ${t}`),u&&p&&v&&(u.width=innerWidth,u.height=innerHeight-p.getBoundingClientRect().height-v.getBoundingClientRect().height-7,b.draw(),x.draw(y,u))}));
//# sourceMappingURL=index.b57a51e7.js.map
