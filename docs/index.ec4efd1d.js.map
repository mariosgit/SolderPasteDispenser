{"mappings":"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","sources":["node_modules/canvas-coords/dist/index.js","src/device.ts","node_modules/kd-tree-javascript/kdTree-min.js","src/pcb.ts","src/index.ts","src/deviceMarlin.ts"],"sourcesContent":["(function () {var a={};function g(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function c(t,e){for(var o=0;o<e.length;o++){var s=e[o];s.enumerable=s.enumerable||!1,s.configurable=!0,\"value\"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function h(t,e,o){return e&&c(t.prototype,e),o&&c(t,o),t}var i=function(){function t(e,o){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"gray\",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"16px Monospace\",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;g(this,t),this.x=r,this.y=n,this.ctx=e,this.canvas=o,this.color=s,this.font=i,this.setPos=this.setPos.bind(this)}return h(t,[{key:\"track\",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.canvas;return t?e.addEventListener(\"mousemove\",this.setPos):e.removeEventListener(\"mousemove\",this.setPos),this}},{key:\"setPos\",value:function(t){var e=this.canvas.getBoundingClientRect();return this.x=Math.floor(t.clientX-e.left),this.y=Math.floor(t.clientY-e.top),this}},{key:\"draw\",value:function(){var t=this.x,e=this.y,o=this.canvas,s=this.ctx,i=this.font,r=this.color,n=\"X: \".concat(t,\", Y: \").concat(e);s.save(),s.fillStyle=r,s.font=i;var a=t<o.width/2?20:-s.measureText(n).width-20,v=e<o.height/2?25:-18;return s.fillText(n,this.x+a,this.y+v),s.restore(),this}}]),t}();function d(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function f(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,\"value\"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function e(t,e,i){return e&&f(t.prototype,e),i&&f(t,i),t}var b=function(){function t(e,i,s,r,l,n){d(this,t),this.color=e,this.lineWidth=i,this.startX=s,this.startY=r,this.endX=l,this.endY=n}return e(t,[{key:\"draw\",value:function(t){var e=this.color,i=this.lineWidth,s=this.startX,r=this.startY,l=this.endX,n=this.endY;t.save(),t.beginPath(),t.strokeStyle=e,t.lineWidth=i,t.moveTo(s,r),t.lineTo(l,n),t.stroke(),t.restore()}}]),t}(),j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"gray\",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:\"DarkGray\",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:\"16px Monospace\";d(this,t),this.color=e,this.lineWidth=i,this.step=s,this.boldNth=r,this.boldColor=l,this.boldWidth=n,this.font=o,this.lines=null}return e(t,[{key:\"createLines\",value:function(t){for(var e=this.color,i=this.lineWidth,s=this.step,r=this.boldNth,l=this.boldColor,n=this.boldWidth,o=[],a=r*s,h=0;h<t.width;h+=s){var v=h%a==0;o.push(v?new b(l,n,h,0,h,t.height):new b(e,i,h,0,h,t.height))}for(var $=0;$<t.height;$+=s){var d=$%a==0;o.push(d?new b(l,n,0,$,t.width,$):new b(e,i,0,$,t.width,$))}this.lines=o}},{key:\"drawText\",value:function(t,e){var i=this.step,s=this.boldNth,r=this.boldColor,l=this.font;t.save(),t.font=l,t.fillStyle=r,t.fillText(\"0\",1,15);for(var n=i*s;n<e.width;n+=i*s)t.fillText(n,n,15);for(var o=i*s;o<e.height;o+=i*s)t.fillText(o,0,o+15);t.restore()}},{key:\"draw\",value:function(t,e){this.lines||this.createLines(e),this.lines.forEach(function(e){return e.draw(t)}),this.drawText(t,e)}}]),t}();a.Mouse=i,a.Grid=j;if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=a}else if(typeof define===\"function\"&&define.amd){define(function(){return a})}})();","// todo:\r\n//   move out serial ? Or look for a serial readline implementation ???\r\n// bugs:\r\n//   disconnect - Failed to execute 'close' on 'SerialPort': Cannot cancel a locked stream\r\n\r\nexport class Device {\r\n    deviceCheck: HTMLButtonElement | null;\r\n    deviceConnect: HTMLButtonElement | null;\r\n    deviceDisconnect: HTMLButtonElement | null;\r\n    deviceDosome: HTMLButtonElement | null;\r\n    deviceInput: HTMLInputElement | null;\r\n    deviceInputForm: HTMLFormElement | null;\r\n    deviceLog: HTMLDivElement | null;\r\n    port: any;\r\n    textDecoder: TextDecoderStream;\r\n    reader: ReadableStreamDefaultReader<string>;\r\n    inputQueue: string[] = [];\r\n    inputLast: string = '';\r\n    constructor() {\r\n        this.deviceCheck = <HTMLButtonElement | null>document.getElementById(\"deviceCheck\");\r\n        this.deviceConnect = <HTMLButtonElement | null>document.getElementById(\"deviceConnect\");\r\n        this.deviceDisconnect = <HTMLButtonElement | null>document.getElementById(\"deviceDisconnect\");\r\n        this.deviceDosome = <HTMLButtonElement | null>document.getElementById(\"deviceDosome\");\r\n        this.deviceInput = <HTMLInputElement | null>document.getElementById(\"deviceInput\");\r\n        this.deviceInputForm = <HTMLFormElement | null>document.getElementById(\"deviceInputForm\");\r\n        this.deviceLog = <HTMLDivElement | null>document.getElementById(\"deviceLog\");\r\n        this.port = null;\r\n        this.textDecoder = new TextDecoderStream();\r\n        if (this.deviceCheck && this.deviceConnect && this.deviceDisconnect && this.deviceDosome && this.deviceInput && this.deviceInputForm) {\r\n            this.deviceCheck.onclick = this.serialCheck.bind(this);\r\n            this.deviceConnect.onclick = this.serialConnect.bind(this);\r\n            this.deviceDisconnect.onclick = this.serialDisconnect.bind(this);\r\n            this.deviceDosome.onclick = this.serialDosome.bind(this);\r\n            // this.deviceInput.onchange = this.serialInputChange.bind(this);\r\n            this.deviceInputForm.onsubmit = this.serialInputForm.bind(this);\r\n        }\r\n        this.serialCheck();\r\n    }\r\n    async serialCheck() {\r\n        let result = false;\r\n        if (\"serial\" in navigator) {\r\n            this.updatePorts();\r\n            navigator.serial.addEventListener(\"connect\", (event) => {\r\n                // TODO: Automatically open event.target or warn user a port is available.\r\n                console.log(event);\r\n                this.updatePorts();\r\n            });\r\n            navigator.serial.addEventListener(\"disconnect\", (event) => {\r\n                // TODO: Remove |event.target| from the UI.\r\n                // If the serial port was opened, a stream error would be observed as well.\r\n                console.log(event);\r\n            });\r\n            result = true;\r\n        } else {\r\n            console.warn('No serial API available, try onother browser');\r\n        }\r\n        return result;\r\n    }\r\n    updatePorts() {\r\n        // lists all recently used ports, could just open one then.\r\n        navigator.serial.getPorts().then((ports) => {\r\n            for (let port of ports) {\r\n                // console.log(`serial available, ports: `, port);\r\n                const { usbProductId, usbVendorId } = port.getInfo();\r\n                console.log(`updatePorts port pid:${usbProductId} vid:${usbVendorId}`);\r\n            }\r\n        });\r\n    }\r\n    serialError(error:string) {\r\n        if(this.deviceLog) {\r\n            this.deviceLog.innerHTML += `<span class=\"w3-red\">${error}</span>`\r\n        }\r\n    }\r\n\r\n    protected onSerialConnected() {\r\n        console.log('Device: onSerialConnected')\r\n    }\r\n    protected onSerialDisconnected() {\r\n        console.log('Device: onSerialDisconnected')\r\n    }\r\n\r\n    async serialConnect() {\r\n        // opens dialog where user can select a device\r\n        this.port = await navigator.serial.requestPort();\r\n        await this.port.open({ baudRate: 250000 }).then((val) => {\r\n            console.log('port opened ? ', this.port);\r\n            if(this.deviceLog) {\r\n                this.deviceLog.innerHTML = \"connected<br>\";\r\n            }\r\n            this.port.onconnect = () => { console.log(`CONNECTED`); };\r\n            this.port.ondisconnect = () => { console.log(`DISCONNECTED`); this.onSerialDisconnected(); };\r\n            setTimeout(this.serialRead.bind(this), 0);\r\n            this.onSerialConnected(); // signal derived class\r\n        }).catch((error) => {\r\n            console.warn(error);\r\n            this.serialError(error.toString());\r\n        });\r\n    }\r\n    async serialRead() {\r\n        if (this.port) {\r\n            const readableStreamClosed = this.port.readable.pipeTo(this.textDecoder.writable);\r\n            this.reader = this.textDecoder.readable.getReader();\r\n            // Listen to data coming from the serial device.\r\n            setTimeout(this.serialReadon.bind(this), 1); // will loop there\r\n        }\r\n    }\r\n    async serialReadon() {\r\n        try {\r\n            const { value, done } = await this.reader.read();\r\n            if (done) {\r\n                // Allow the serial port to be closed later. // Does not happen !\r\n                this.reader.releaseLock();\r\n                console.log('serialRead - done');\r\n            } else {\r\n                let pushedStuff = false;\r\n                // value is a string.\r\n                if (value.indexOf('\\n') != -1) {\r\n                    const values = value.split('\\n');\r\n                    // console.log(values);\r\n                    if (values.length <= 1) {\r\n                        console.error('Assertion failed ', values);\r\n                    }; // there is a \\n in it !\r\n                    for (let i = 0; i < values.length - 1; i++) {\r\n                        this.inputLast += values[i];\r\n                        this.inputQueue.push(this.inputLast);\r\n                        this.inputLast = '';\r\n                        pushedStuff = true;\r\n                    }\r\n                    this.inputLast = values[values.length - 1];\r\n                    // console.log(`serialReadon last: \"${this.inputLast}\"`);\r\n                } else {\r\n                    // no \\n\r\n                    this.inputLast += value;\r\n                    // console.log(`serialReadon last: \"${this.inputLast}\"`);\r\n                }\r\n\r\n                if (pushedStuff) {\r\n                    setTimeout(this.serialCallback.bind(this), 5);\r\n                }\r\n                setTimeout(this.serialReadon.bind(this), 1); // will loop there\r\n            }\r\n        } catch (error) {\r\n            console.warn(error);\r\n            this.serialError(error.toString());\r\n        }\r\n    }\r\n    serialCallback() {\r\n        const elem = document.getElementById('deviceLog');\r\n        if (elem) {\r\n            let latest = this.inputQueue.pop();\r\n            while (latest) {\r\n                elem.innerHTML += `${latest}<br>`;\r\n                latest = this.inputQueue.pop();\r\n            }\r\n        }\r\n    }\r\n    async serialWrite(value:string) {\r\n        let utf8Encode = new TextEncoder();\r\n        const writer = this.port.writable.getWriter();\r\n        await writer.write(utf8Encode.encode(`${value}\\n`));\r\n        writer.releaseLock();\r\n    }\r\n    async serialDisconnect() {\r\n        if (this.port) {\r\n            // this.reader.releaseLock(); // does'nt do it :(\r\n            this.port.close().then(() => {\r\n                this.port = null;\r\n                console.log('port closed');\r\n            }).catch((error) => {\r\n                console.warn(error);\r\n            });\r\n        }\r\n    }\r\n    async serialDosome() {\r\n        // const { usbProductId, usbVendorId } = this.port.getInfo();\r\n        // console.log(`serialDosome info ${usbProductId} ${usbVendorId}`);\r\n\r\n        // send some nonsense\r\n        let utf8Encode = new TextEncoder();\r\n        const writer = this.port.writable.getWriter();\r\n        await writer.write(utf8Encode.encode(\"hiho\\n\"));\r\n        writer.releaseLock();\r\n    }\r\n    async serialInputForm(event: InputEvent) { // fires when return is entered\r\n        if (this.deviceInput) {\r\n            event.preventDefault(); // form will do strange things !\r\n            // console.log(event);\r\n            this.serialInputChange(event);\r\n        }\r\n    }\r\n\r\n    async serialInputChange(event: InputEvent) { // fires when return is entered\r\n        if (this.deviceInput) {\r\n            if (this.port) {\r\n                let text = this.deviceInput.value;\r\n                if (text.length > 0) {\r\n                    let utf8Encode = new TextEncoder();\r\n                    const writer = this.port.writable.getWriter();\r\n                    await writer.write(utf8Encode.encode(`${text}\\n`));\r\n                    writer.releaseLock();\r\n                }\r\n            } else {\r\n                console.warn('serialInputChange - no port open');\r\n            }\r\n        }\r\n    }\r\n}","/**\n * k-d Tree JavaScript - V 1.01\n *\n * https://github.com/ubilabs/kd-tree-javascript\n *\n * @author Mircea Pricop <pricop@ubilabs.net>, 2012\n * @author Martin Kleppe <kleppe@ubilabs.net>, 2012\n * @author Ubilabs http://ubilabs.net, 2012\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n */!function(t,n){\"function\"==typeof define&&define.amd?define([\"exports\"],n):n(\"object\"==typeof exports?exports:t)}(this,function(t){function n(t,n,o){this.obj=t,this.left=null,this.right=null,this.parent=o,this.dimension=n}function o(t){this.content=[],this.scoreFunction=t}o.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var n=this.content.length,o=0;o<n;o++)if(this.content[o]==t){var i=this.content.pop();return void(o!=n-1&&(this.content[o]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(o):this.sinkDown(o)))}throw new Error(\"Node not found.\")},size:function(){return this.content.length},bubbleUp:function(t){for(var n=this.content[t];t>0;){var o=Math.floor((t+1)/2)-1,i=this.content[o];if(!(this.scoreFunction(n)<this.scoreFunction(i)))break;this.content[o]=n,this.content[t]=i,t=o}},sinkDown:function(t){for(var n=this.content.length,o=this.content[t],i=this.scoreFunction(o);;){var e=2*(t+1),r=e-1,l=null;if(r<n){var u=this.content[r],h=this.scoreFunction(u);h<i&&(l=r)}if(e<n){var s=this.content[e];this.scoreFunction(s)<(null==l?i:h)&&(l=e)}if(null==l)break;this.content[t]=this.content[l],this.content[l]=o,t=l}}},t.kdTree=function(t,i,e){function r(t,o,i){var l,u,h=o%e.length;return 0===t.length?null:1===t.length?new n(t[0],h,i):(t.sort(function(t,n){return t[e[h]]-n[e[h]]}),l=Math.floor(t.length/2),u=new n(t[l],h,i),u.left=r(t.slice(0,l),o+1,u),u.right=r(t.slice(l+1),o+1,u),u)}var l=this;Array.isArray(t)?this.root=r(t,0,null):function(t){function n(t){t.left&&(t.left.parent=t,n(t.left)),t.right&&(t.right.parent=t,n(t.right))}l.root=t,n(l.root)}(t),this.toJSON=function(t){t||(t=this.root);var o=new n(t.obj,t.dimension,null);return t.left&&(o.left=l.toJSON(t.left)),t.right&&(o.right=l.toJSON(t.right)),o},this.insert=function(t){function o(n,i){if(null===n)return i;var r=e[n.dimension];return t[r]<n.obj[r]?o(n.left,n):o(n.right,n)}var i,r,l=o(this.root,null);null!==l?(i=new n(t,(l.dimension+1)%e.length,l),r=e[l.dimension],t[r]<l.obj[r]?l.left=i:l.right=i):this.root=new n(t,0,null)},this.remove=function(t){function n(o){if(null===o)return null;if(o.obj===t)return o;var i=e[o.dimension];return t[i]<o.obj[i]?n(o.left,o):n(o.right,o)}function o(t){function n(t,o){var i,r,l,u,h;return null===t?null:(i=e[o],t.dimension===o?null!==t.left?n(t.left,o):t:(r=t.obj[i],l=n(t.left,o),u=n(t.right,o),h=t,null!==l&&l.obj[i]<r&&(h=l),null!==u&&u.obj[i]<h.obj[i]&&(h=u),h))}var i,r,u;if(null===t.left&&null===t.right)return null===t.parent?void(l.root=null):(u=e[t.parent.dimension],void(t.obj[u]<t.parent.obj[u]?t.parent.left=null:t.parent.right=null));null!==t.right?(r=(i=n(t.right,t.dimension)).obj,o(i),t.obj=r):(r=(i=n(t.left,t.dimension)).obj,o(i),t.right=t.left,t.left=null,t.obj=r)}var i;null!==(i=n(l.root))&&o(i)},this.nearest=function(t,n,r){function u(o){function r(t,o){f.push([t,o]),f.size()>n&&f.pop()}var l,h,s,c,a=e[o.dimension],g=i(t,o.obj),p={};for(c=0;c<e.length;c+=1)c===o.dimension?p[e[c]]=t[e[c]]:p[e[c]]=o.obj[e[c]];h=i(p,o.obj),null!==o.right||null!==o.left?(u(l=null===o.right?o.left:null===o.left?o.right:t[a]<o.obj[a]?o.left:o.right),(f.size()<n||g<f.peek()[1])&&r(o,g),(f.size()<n||Math.abs(h)<f.peek()[1])&&null!==(s=l===o.left?o.right:o.left)&&u(s)):(f.size()<n||g<f.peek()[1])&&r(o,g)}var h,s,f;if(f=new o(function(t){return-t[1]}),r)for(h=0;h<n;h+=1)f.push([null,r]);for(l.root&&u(l.root),s=[],h=0;h<Math.min(n,f.content.length);h+=1)f.content[h][0]&&s.push([f.content[h][0].obj,f.content[h][1]]);return s},this.balanceFactor=function(){function t(n){return null===n?0:Math.max(t(n.left),t(n.right))+1}function n(t){return null===t?0:n(t.left)+n(t.right)+1}return t(l.root)/(Math.log(n(l.root))/Math.log(2))}},t.BinaryHeap=o});\n","import {kdTree} from 'kd-tree-javascript';\r\n\r\nclass BoundingBox {\r\n    minx: number = 99999;\r\n    miny: number = 99999;\r\n    maxx: number = -99999;\r\n    maxy: number = -99999;\r\n    constructor() { }\r\n    update(x: number, y: number) {\r\n        if (x < this.minx) this.minx = x;\r\n        if (y < this.miny) this.miny = y;\r\n        if (x > this.maxx) this.maxx = x;\r\n        if (y > this.maxy) this.maxy = y;\r\n        // console.log(`bb: ${this.miny} ${this.maxy} ${this.center()[1]}`);\r\n    }\r\n    center(zoom: number = 1.0): [x: number, y: number] {\r\n        return [(this.minx + (this.maxx - this.minx) / 2) * zoom, (this.miny + (this.maxy - this.miny) / 2) * zoom];\r\n    }\r\n    zero(zoom: number = 1.0): [x: number, y: number] {\r\n        return [this.minx * zoom, this.miny * zoom];\r\n    }\r\n    size(zoom: number = 1.0): [x: number, y: number] {\r\n        return [(this.maxx - this.minx) * zoom, (this.maxy - this.miny) * zoom];\r\n    }\r\n}\r\nclass PadStyle {\r\n    public form: string;\r\n    public width: number;\r\n    public height: number;\r\n    constructor(form: string, w: number, h: number) {\r\n        this.form = form;\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n}\r\nclass Pad {\r\n    posX: number;\r\n    posY: number;\r\n    style: string;\r\n    constructor(style: string, x: number, y: number) {\r\n        this.posX = x;\r\n        this.posY = y;\r\n        this.style = style;\r\n    }\r\n}\r\n\r\nexport class PCB {\r\n    ctx: CanvasRenderingContext2D;\r\n    canvas: HTMLCanvasElement;\r\n    mapStyles: Map<string, PadStyle>;\r\n    mapPads: Map<string, Set<Pad>>;\r\n    fileName: string = \"\";\r\n\r\n    mouseFlag: boolean = false;\r\n    mouseStartX: number = 0;\r\n    mouseStartY: number = 0;\r\n    mouseOffX: number = 0;\r\n    mouseOffY: number = 0;\r\n\r\n    zoom: number = 6.0;\r\n    bb: BoundingBox;\r\n\r\n    tree: any;\r\n    nearest: any = [];\r\n\r\n    constructor(ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement) {\r\n        this.ctx = ctx;\r\n        this.canvas = canvas;\r\n        this.mapStyles = new Map<string, PadStyle>();\r\n        this.mapPads = new Map<string, Set<Pad>>();\r\n        this.bb = new BoundingBox();\r\n    }\r\n\r\n    draw() {\r\n        // theoretisch so...\r\n        // this.ctx.fillStyle = 'orangered';\r\n        this.ctx.fillStyle = 'antiquewhite';\r\n\r\n        // draw zero\r\n        this.ctx.strokeStyle = 'black';\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(-10 + this.mouseOffX, 0 + this.mouseOffY);\r\n        this.ctx.lineTo(10 + this.mouseOffX, 0 + this.mouseOffY);\r\n        this.ctx.moveTo(0 + this.mouseOffX, -10 + this.mouseOffY);\r\n        this.ctx.lineTo(0 + this.mouseOffX, 10 + this.mouseOffY);\r\n        this.ctx.stroke();\r\n\r\n        // draw bb center\r\n        this.ctx.strokeStyle = 'red';\r\n        let center = this.bb.center(this.zoom);\r\n        this.ctx.beginPath();\r\n        this.ctx.moveTo(center[0] - 10 + this.mouseOffX, center[1] + this.mouseOffY);\r\n        this.ctx.lineTo(center[0] + 10 + this.mouseOffX, center[1] + this.mouseOffY);\r\n        this.ctx.moveTo(center[0] + this.mouseOffX, center[1] - 10 + this.mouseOffY);\r\n        this.ctx.lineTo(center[0] + this.mouseOffX, center[1] + 10 + this.mouseOffY);\r\n        this.ctx.stroke();\r\n        // draw bb\r\n        this.ctx.beginPath();\r\n        this.ctx.rect(this.bb.zero(this.zoom)[0] + this.mouseOffX, this.bb.zero(this.zoom)[1] + this.mouseOffY, this.bb.size(this.zoom)[0], this.bb.size(this.zoom)[1]);\r\n        this.ctx.stroke();\r\n\r\n        for (let padstyle of this.mapPads.keys()) {\r\n\r\n            const sty = this.mapStyles.get(padstyle);\r\n            const padset = this.mapPads.get(padstyle);\r\n            if (sty && padset) {\r\n                const sw = sty.width * this.zoom;\r\n                const sh = sty.height * this.zoom;\r\n                for (let pad of padset.values()) {\r\n                    if (sty.form == 'R' || sty.form == 'O' || sty.form == 'RoundRect') {\r\n                        this.ctx.beginPath();\r\n\r\n                        this.ctx.fillRect(\r\n                            pad.posX * this.zoom - sw / 2.0 + this.mouseOffX,\r\n                            pad.posY * this.zoom - sh / 2.0 + this.mouseOffY,\r\n                            sw, sh);\r\n                        this.ctx.fill();\r\n\r\n                    } else if (sty.form == 'C') {\r\n                        this.ctx.beginPath();\r\n                        this.ctx.ellipse(\r\n                            pad.posX * this.zoom + this.mouseOffX,\r\n                            pad.posY * this.zoom + this.mouseOffY,\r\n                            sw / 2,\r\n                            sw / 2,\r\n                            0, 0, 2 * Math.PI);\r\n                        // this.ctx.arc(\r\n                        //     pad.posX * this.zoom - sw / 2.0 + this.mouseOffX,\r\n                        //     pad.posY * this.zoom - sh / 2.0 + this.mouseOffY,\r\n                        //     sty.width * this.zoom,\r\n                        //     0, 2 * Math.PI);\r\n                        this.ctx.fill();\r\n                    } else {\r\n                        console.log(`draw quatsch ${sty.form}`);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        } // for padstyle\r\n        this.ctx.strokeStyle = 'purple';\r\n        this.ctx.beginPath();\r\n        const csize = 5;\r\n        for(const near of this.nearest) {\r\n            this.ctx.moveTo((near[0].posX-csize) * this.zoom + this.mouseOffX, near[0].posY * this.zoom + this.mouseOffY);\r\n            this.ctx.lineTo((near[0].posX+csize) * this.zoom + this.mouseOffX, near[0].posY * this.zoom + this.mouseOffY);\r\n            this.ctx.moveTo(near[0].posX * this.zoom + this.mouseOffX, (near[0].posY+csize) * this.zoom + this.mouseOffY);\r\n            this.ctx.lineTo(near[0].posX * this.zoom + this.mouseOffX, (near[0].posY-csize) * this.zoom + this.mouseOffY);\r\n\r\n            // console.log(`nearest:${near[0].posX},${near[0].posY}  dist:${Math.sqrt(near[1])}`);\r\n        }\r\n        this.ctx.stroke();\r\n\r\n    }\r\n\r\n    addPadStyle(name: string, form: string, w: number, h: number) {\r\n        this.mapStyles.set(name, new PadStyle(form, w, h));\r\n    }\r\n\r\n    addPad(style: string, x: number, y: number) {\r\n        if (!this.mapPads.has(style)) {\r\n            this.mapPads.set(style, new Set<Pad>());\r\n        }\r\n        let padset = this.mapPads.get(style);\r\n        if (padset) {\r\n            const newpad = new Pad(style, x, y);\r\n            padset.add(newpad);\r\n            this.bb.update(x, y);\r\n        }\r\n    }\r\n\r\n    center() {\r\n        if (this.canvas) {\r\n            this.mouseOffX = -(this.bb.center()[0] * this.zoom) + this.canvas.width / 2;\r\n            this.mouseOffY = -(this.bb.center()[1] * this.zoom) + this.canvas.height / 2;\r\n        }\r\n    }\r\n\r\n    retree() {\r\n        try {\r\n            let pads : Pad[] = [];\r\n            for (let padsets of this.mapPads.values()) {\r\n                for (let pad of padsets) {\r\n                    pads.push(pad);\r\n                }\r\n            }\r\n            \r\n            this.tree = new kdTree(pads, PCB.distance, [\"posX\", \"posY\"]);\r\n            console.log('tree bf:', this.tree.balanceFactor());\r\n    \r\n        } catch(err) { console.error(err); }\r\n    }\r\n\r\n    mouseDown(event: MouseEvent) {\r\n        const trans = this.ctx.getTransform();\r\n        console.log(trans);\r\n        this.mouseStartX = event.clientX * trans.a - this.mouseOffX;\r\n        this.mouseStartY = event.clientY * trans.d - this.mouseOffY;\r\n        this.mouseFlag = true;\r\n    }\r\n    mouseUp(event: MouseEvent) {\r\n        this.mouseFlag = false;\r\n\r\n        const trans = this.ctx.getTransform();\r\n        console.log(trans, event);\r\n        console.log('', this.canvas.height-(event.clientY-this.canvas.offsetTop), this.mouseOffY);\r\n        const mx = (event.clientX * trans.a - this.mouseOffX) / this.zoom;\r\n        const my = (this.canvas.height-(event.clientY - this.canvas.offsetTop) - this.mouseOffY) / this.zoom;\r\n        if(this.tree) {\r\n            this.nearest = this.tree.nearest({ posX: mx, posY: my }, 1);\r\n            for(const near of this.nearest) {\r\n                console.log(`m:${mx},${my} nearest:${near[0].posX},${near[0].posY}  dist:${Math.sqrt(near[1])}`);\r\n            }\r\n        }\r\n    }\r\n    mouseMove(event: MouseEvent) {\r\n        const trans = this.ctx.getTransform();\r\n        if (this.mouseFlag) {\r\n            this.mouseOffX = event.clientX * trans.a - this.mouseStartX;\r\n            this.mouseOffY = event.clientY * trans.d - this.mouseStartY;\r\n        }\r\n    }\r\n    mouseWheel(event: WheelEvent) {\r\n        // console.log(event.deltaY);\r\n        if (event.deltaY > 0) {\r\n            this.zoom *= 1.1;\r\n        } else {\r\n            this.zoom *= 0.9;\r\n        }\r\n    }\r\n\r\n    static distance(a:Pad, b:Pad) {\r\n        return Math.pow(a.posX - b.posX, 2) +  Math.pow(a.posY - b.posY, 2);\r\n    }\r\n}\r\n","import { Grid, Mouse } from 'canvas-coords' // https://github.com/CodeDraken/canvas-coords\r\nimport { Device } from './device';\r\nimport { Marlin } from './deviceMarlin';\r\nimport { PCB } from './pcb';\r\n\r\nconst body: HTMLBodyElement | null = <HTMLBodyElement | null>document.getElementsByTagName('body')[0];\r\nconst uploadButton: HTMLButtonElement | null = <HTMLButtonElement | null>document.getElementById(\"uploadButton\");\r\nconst padsField: HTMLDivElement | null = <HTMLDivElement | null>document.getElementById(\"padsField\");\r\nconst coordsField: HTMLDivElement | null = <HTMLDivElement | null>document.getElementById(\"coordsField\");\r\nconst dropZone: HTMLElement | null = document.getElementById(\"dropZone\");\r\nconst canvas: HTMLCanvasElement | null = <HTMLCanvasElement | null>document.getElementById(\"canvas\");\r\nconst progress: HTMLDivElement | null = <HTMLDivElement | null>document.getElementById(\"progress\");\r\nconst progressbar: HTMLDivElement | null = <HTMLDivElement | null>document.getElementById('progressbar');\r\nconst progressCancel: HTMLButtonElement | null = <HTMLButtonElement | null>document.getElementById('progressCancel');\r\n\r\nconst header = document.getElementsByTagName('header')[0];\r\nconst footer = document.getElementsByTagName('footer')[0];\r\n\r\nlet ctx: CanvasRenderingContext2D | null = null;\r\nlet mouse: Mouse, grid: Grid;\r\nlet pcb: PCB;\r\nlet floatFracts = 1;\r\nlet floatDezis = 1;\r\nlet lastPad = \"\";\r\n\r\nlet cancel = false;\r\n\r\nconst reNumFormat = /^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/;\r\nconst reMatchPad = /^(%AD)(D[0-9]+)([A-Za-z]+)[,]([-0-9.]+)[X]?([-0-9.]+)?[X]?([-0-9.]+)?/;\r\nconst reMatchPadCoordInit = /^([DG][0-9]+)[*]/;\r\nconst reMatchPadCoord = /^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/;\r\n\r\nlet device = new Marlin();\r\n\r\nfunction init() {\r\n    console.log('moinsen');\r\n\r\n    if (uploadButton && progressCancel && padsField && coordsField && body && canvas) {\r\n        ctx = canvas.getContext(\"2d\");\r\n\r\n        canvas.addEventListener(\"mousemove\", (event) => {\r\n            if (pcb) pcb.mouseMove(event);\r\n            event.preventDefault();\r\n        }, false);\r\n        canvas.addEventListener(\"mousedown\", (event) => {\r\n            if (pcb) pcb.mouseDown(event);\r\n            event.preventDefault();\r\n        }, false);\r\n        canvas.addEventListener(\"mouseup\", (event) => {\r\n            if (pcb) pcb.mouseUp(event);\r\n            event.preventDefault();\r\n        }, false);\r\n        canvas.addEventListener(\"mouseout\", (event) => {\r\n            if (pcb) pcb.mouseUp(event);\r\n            event.preventDefault();\r\n        }, false);\r\n        canvas.addEventListener(\"wheel\", (event) => {\r\n            if (pcb) pcb.mouseWheel(event);\r\n            event.preventDefault();\r\n        }, false);\r\n\r\n        uploadButton.onclick = () => {\r\n            var uploadFileEle = document.createElement('input');\r\n            uploadFileEle.type = \"file\";\r\n            uploadFileEle.click();\r\n            uploadFileEle.addEventListener(\"change\", (ev: Event) => {\r\n                console.log(ev);\r\n                // check if user had selected a file\r\n                if (uploadFileEle.files && uploadFileEle.files.length > 0) {\r\n                    let file = uploadFileEle.files[0]\r\n                    console.log(file);\r\n                    console.log(`file: ${file.name} size:${file.size}`);\r\n\r\n                    processGerberFile(file);\r\n\r\n                } else {\r\n                    alert('please choose a file')\r\n                    return\r\n                }\r\n            })\r\n            return false;\r\n        }\r\n        progressCancel.onclick = () => {\r\n            cancel = true;\r\n        }\r\n\r\n        body.ondrop = (ev) => {\r\n            ev.preventDefault();\r\n            console.log(ev);\r\n            if (ev.dataTransfer.items) {\r\n                // Use DataTransferItemList interface to access the file(s)\r\n                [...ev.dataTransfer.items].forEach((item, i) => {\r\n                    // If dropped items aren't files, reject them\r\n                    if (item.kind === 'file') {\r\n                        const file = item.getAsFile();\r\n                        if (file) {\r\n                            console.log(` item[${i}].name = ${file.name}`);\r\n                            processGerberFile(file);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                // Use DataTransfer interface to access the file(s)\r\n                [...ev.dataTransfer.files].forEach((file, i) => {\r\n                    if (file) {\r\n                        console.log(` file[${i}].name = ${file.name}`);\r\n                        processGerberFile(file);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        body.ondragover = (ev) => {\r\n            console.log('File(s) in drop zone');\r\n\r\n            // Prevent default behavior (Prevent file from being opened)\r\n            ev.preventDefault();\r\n        }\r\n\r\n        canvas.width = innerWidth;\r\n        canvas.height = innerHeight - header.getBoundingClientRect().height - footer.getBoundingClientRect().height - 7;\r\n\r\n        mouse = new Mouse(ctx, canvas);\r\n        mouse.track();\r\n        grid = new Grid();\r\n        window.requestAnimationFrame(update);\r\n    }\r\n    else {\r\n        console.error('missing html elements !');\r\n    }\r\n}\r\n\r\nfunction update() {\r\n    if (canvas && ctx) {\r\n        window.requestAnimationFrame(update);\r\n\r\n        ctx.setTransform(\r\n            1, 0,\r\n            0, -1,\r\n            0, canvas.height);\r\n\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        grid.draw(ctx, canvas);\r\n        mouse.draw();\r\n\r\n        // ctx.scale(1,-1); // flip display y\r\n\r\n        if (pcb) {\r\n            pcb.draw();\r\n        }\r\n    }\r\n}\r\n\r\nfunction processGerberFile(file: File) {\r\n    if (uploadButton && padsField && coordsField && body && ctx && progress) { // makes typescript happy...\r\n        file.arrayBuffer().then((buf) => {\r\n            arrayBufferToString(buf, 'UTF-8', (text: string) => {\r\n\r\n                padsField.innerHTML = '';\r\n                coordsField.innerHTML = '';\r\n\r\n                if (dropZone)\r\n                    dropZone.innerText = file.name;\r\n\r\n                processGerberText(text);\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nasync function processGerberText(text: string) {\r\n    if (uploadButton && padsField && coordsField && body && canvas && ctx && progress) { // makes typescript happy...\r\n\r\n        progress.style.display = 'block';\r\n\r\n        pcb = new PCB(ctx, canvas);\r\n\r\n        // console.log(text);\r\n        // translate line ends...\r\n        text = text.replace(/\\r/g, ''); // remove windows trash\r\n        const lines = text.split('\\n');\r\n\r\n        let lineNr = 1;\r\n        for (let line of lines) {\r\n            lineNr++;\r\n\r\n            if (cancel) {\r\n                cancel = false;\r\n                break;\r\n            }\r\n            // console.log(`gerber(${lineNr}/${lines.length}): `);\r\n\r\n            await processGerberLine(line);\r\n\r\n            if (progressbar) {\r\n                progressbar.style.width = `${lineNr * 100 / lines.length}%`;\r\n            }\r\n\r\n        } // for\r\n\r\n        pcb.retree();\r\n\r\n        progress.style.display = 'none';\r\n    }\r\n}\r\n\r\n\r\nasync function processGerberLine(line: string) {\r\n    return new Promise<void>((resolve) => {\r\n        if (uploadButton && padsField && coordsField && body && ctx && progress) { // makes typescript happy...\r\n\r\n            // line = line.replace(/\\n/g,'<br>');\r\n\r\n            // Zahlenformat info line \"%FSLAX34Y34*%\"\r\n            //   %FSLAX25Y25*% Coordinate format specification:\r\n            //   Coordinates format is 2.5:\r\n            //   2 digits in the integer part\r\n            //   5 digits in the fractional part\r\n            const matchNumFormat = reNumFormat.exec(line); //line.match();\r\n            if (matchNumFormat) {\r\n                // console.log(matchNumFormat);\r\n                floatDezis = parseInt(matchNumFormat[1]);\r\n                floatFracts = parseInt(matchNumFormat[2]);\r\n                console.log(`gerber: float digits = ${floatDezis} ${floatFracts}`);\r\n            }\r\n\r\n            // check for pad definitions\r\n            // %ADD21R,0.600000X1.050000*%\r\n            // %ADD10RoundRect,0.120000 X -0.180000\r\n            //               X 0.680000 X -0.180000\r\n            //              X -0.680000 X 0.180000\r\n            //              X -0.680000 X 0.180000\r\n            //               X 0.680000 X 0*%\r\n            const matchPad = reMatchPad.exec(line); // line.match();///);\r\n            // Wenn \"C\" dann gibts nur eine coord\r\n            if (matchPad) {\r\n                // console.log(matchPad);\r\n                padsField.innerHTML += `${matchPad[2]} ${matchPad[3]} ${matchPad[4]} ${matchPad[5]}<br>`;\r\n                if (matchPad[3] == 'RoundRect') {\r\n                    // kicad macro schnulli\r\n                    pcb.addPadStyle(matchPad[2], matchPad[3], Math.abs(parseFloat(matchPad[5])), Math.abs(parseFloat(matchPad[6])));\r\n                    // console.log(`gerber: style ${matchPad[2]},${matchPad[3]}, ${Math.abs(parseFloat(matchPad[5]))}, ${Math.abs(parseFloat(matchPad[6]))}`);\r\n                } else {\r\n                    pcb.addPadStyle(matchPad[2], matchPad[3], parseFloat(matchPad[4]), parseFloat(matchPad[5]));\r\n                    // console.log(`gerber: style ${matchPad[2]},${matchPad[3]}, ${parseFloat(matchPad[4])}, ${parseFloat(matchPad[5])}`);\r\n                }\r\n            }\r\n\r\n            // Dxx* command - should be pad draw\r\n            const matchPadCoordInit = reMatchPadCoordInit.exec(line); //line.match();///);\r\n            if (matchPadCoordInit) {\r\n                // console.log(matchPadCoordInit);\r\n                lastPad = matchPadCoordInit[1];\r\n            }\r\n            // a pad line: \"X379984Y963930D03*\"\r\n            const matchPadCoord = reMatchPadCoord.exec(line); // line.match();///);\r\n            if (matchPadCoord) {\r\n                if (lastPad.startsWith('D')) { // ignore G36 or so commands\r\n                    // if (1) {\r\n                    // ignore and return ...\r\n                    // resolve();\r\n                    // console.log(matchPadCoord);\r\n                    let sx = matchPadCoord[2];\r\n                    let sy = matchPadCoord[4];\r\n                    const len = floatDezis + floatFracts;\r\n                    // fill freak's leading zeros\r\n                    while (sx.length < len) {\r\n                        sx = `0${sx}`;\r\n                    }\r\n                    while (sy.length < len) {\r\n                        sy = `0${sy}`;\r\n                    }\r\n                    // make a freak'n float\r\n                    let fx = 0.0;\r\n                    let fy = 0.0;\r\n                    sx = `${sx.substring(0, floatDezis)}.${sx.substring(floatDezis)}`;\r\n                    sy = `${sy.substring(0, floatDezis)}.${sy.substring(floatDezis)}`;\r\n                    fx = parseFloat(sx);\r\n                    fy = parseFloat(sy);\r\n                    if (matchPadCoord[1] == '-') {\r\n                        fx = fx * -1.0;\r\n                    }\r\n                    if (matchPadCoord[3] == '-') {\r\n                        fy = fy * -1.0;\r\n                    }\r\n\r\n                    fy = fy;\r\n                    coordsField.innerHTML += `${lastPad}:  x:${fx} y:${fy} <br>`;\r\n\r\n                    pcb.addPad(lastPad, fx, fy);\r\n                    // console.log(`gerber: pad ${lastPad}, ${fx}, ${fy}`);\r\n                } else {\r\n                    console.log(`ignoring ${lastPad}`);\r\n                }\r\n\r\n                // if(lineNr > 1500) {\r\n                //     break; // for testing !!!\r\n                // }\r\n            }\r\n        } // if\r\n        pcb.center();\r\n        setTimeout(resolve, 0); // this enables the progressbar / UI updates !\r\n    });\r\n}\r\n\r\n\r\n// found on se web...\r\n\r\nfunction arrayBufferToString(buffer, encoding, callback) {\r\n    var blob = new Blob([buffer], { type: 'text/plain' });\r\n    var reader = new FileReader();\r\n    reader.onload = (evt) => { callback(evt.target.result); };\r\n    reader.readAsText(blob, encoding);\r\n}\r\n\r\nfunction stringToArrayBuffer(string, encoding, callback) {\r\n    var blob = new Blob([string], { type: 'text/plain;charset=' + encoding });\r\n    var reader = new FileReader();\r\n    reader.onload = (evt) => { callback(evt.target.result); };\r\n    reader.readAsArrayBuffer(blob);\r\n}\r\n\r\nglobalThis.accordionToggler = (id: string) => {\r\n    var elem = document.getElementById(id);\r\n    if (elem) {\r\n        if (elem.className.indexOf(\"w3-show\") == -1 && elem.className.indexOf(\"w3-hide\") == -1) {\r\n            elem.className += \" w3-show\";\r\n        } else if (elem.className.indexOf(\"w3-show\") != -1) {\r\n            elem.className = elem.className.replace(\"w3-show\", \"w3-hide\");\r\n        } else {\r\n            elem.className = elem.className.replace(\"w3-hide\", \"w3-show\");\r\n        }\r\n    } else {\r\n        console.warn('accordionToggler no elem with id:', id);\r\n    }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', init);\r\n\r\nwindow.addEventListener('resize', (val) => {\r\n    console.log(`resize: ${val}`);\r\n    if (canvas && header && footer) {\r\n        canvas.width = innerWidth;\r\n        canvas.height = innerHeight - header.getBoundingClientRect().height - footer.getBoundingClientRect().height - 7;\r\n        mouse.draw();\r\n        grid.draw(ctx, canvas);\r\n    }\r\n})\r\n","/*\r\nTodo:\r\n * SerialWrite += wait for \"ok\" !!! \r\n*/\r\nimport { Device } from \"./device\";\r\n\r\nexport class Marlin extends Device {\r\n    marlinDiv: HTMLElement | null;\r\n    marlinDivStatus: HTMLElement | null;\r\n    constructor() {\r\n        super();\r\n        this.marlinDiv = document.getElementById(\"Marlin\");\r\n        console.log('hallo');\r\n        if(this.marlinDiv) {\r\n            this.marlinDiv.innerHTML = `\r\n            <div id=\"marlinStatus\"></div>\r\n            <div >\r\n            <button id=\"marlinHome\" class=\"w3-button w3-grey\">home</button>\r\n            <button id=\"marlinPos\" class=\"w3-button w3-grey\">pos?</button>\r\n            <button id=\"marlinRel\" class=\"w3-button w3-grey\">rel</button>\r\n            <button id=\"marlinCold\" class=\"w3-button w3-grey\">cold</button>\r\n            <br>\r\n            <button id=\"marlinXP\" class=\"w3-button w3-grey\">x+</button>\r\n            <button id=\"marlinXM\" class=\"w3-button w3-grey\">x-</button>\r\n            <button id=\"marlinYP\" class=\"w3-button w3-grey\">y+</button>\r\n            <button id=\"marlinYM\" class=\"w3-button w3-grey\">y-</button>\r\n            <button id=\"marlinZP\" class=\"w3-button w3-grey\">z+</button>\r\n            <button id=\"marlinZM\" class=\"w3-button w3-grey\">z-</button>\r\n            <button id=\"marlinEP\" class=\"w3-button w3-grey\">e+</button>\r\n            <button id=\"marlinEM\" class=\"w3-button w3-grey\">e-</button>\r\n            </div>\r\n            `\r\n            this.marlinDivStatus = document.getElementById(\"marlinStatus\");\r\n            if(this.marlinDivStatus) {\r\n                this.marlinDivStatus.innerHTML = 'Status: <span class=\"w3-badge w3-grey\"></span> horst';\r\n            }\r\n            const marlinBtnHome = document.getElementById(\"marlinHome\");\r\n            if(marlinBtnHome) {\r\n                marlinBtnHome.onclick = this.onBtnHome.bind(this);\r\n            }\r\n            const marlinBtnPos = document.getElementById(\"marlinPos\");\r\n            if(marlinBtnPos) {\r\n                marlinBtnPos.onclick = this.onBtnPos.bind(this);\r\n            }\r\n            const marlinBtnRel = document.getElementById(\"marlinRel\");\r\n            if(marlinBtnRel) {\r\n                marlinBtnRel.onclick = this.onBtnRel.bind(this);\r\n            }\r\n            const marlinBtnCold = document.getElementById(\"marlinCold\");\r\n            if(marlinBtnCold) {\r\n                marlinBtnCold.onclick = this.onBtnCold.bind(this);\r\n            }\r\n\r\n            const marlinBtnXP = document.getElementById(\"marlinXP\");\r\n            if(marlinBtnXP) {\r\n                marlinBtnXP.onclick = this.onBtnXP.bind(this);\r\n            }\r\n            const marlinBtnXM = document.getElementById(\"marlinXM\");\r\n            if(marlinBtnXM) {\r\n                marlinBtnXM.onclick = this.onBtnXM.bind(this);\r\n            }\r\n            const marlinBtnYP = document.getElementById(\"marlinYP\");\r\n            if(marlinBtnYP) {\r\n                marlinBtnYP.onclick = this.onBtnYP.bind(this);\r\n            }\r\n            const marlinBtnYM = document.getElementById(\"marlinYM\");\r\n            if(marlinBtnYM) {\r\n                marlinBtnYM.onclick = this.onBtnYM.bind(this);\r\n            }\r\n            const marlinBtnZP = document.getElementById(\"marlinZP\");\r\n            if(marlinBtnZP) {\r\n                marlinBtnZP.onclick = this.onBtnZP.bind(this);\r\n            }\r\n            const marlinBtnZM = document.getElementById(\"marlinZM\");\r\n            if(marlinBtnZM) {\r\n                marlinBtnZM.onclick = this.onBtnZM.bind(this);\r\n            }\r\n            const marlinBtnEP = document.getElementById(\"marlinEP\");\r\n            if(marlinBtnEP) {\r\n                marlinBtnEP.onclick = this.onBtnEP.bind(this);\r\n            }\r\n            const marlinBtnEM = document.getElementById(\"marlinEM\");\r\n            if(marlinBtnEM) {\r\n                marlinBtnEM.onclick = this.onBtnEM.bind(this);\r\n            }\r\n        }\r\n    }\r\n    protected onSerialConnected() {\r\n        console.log('Marlin: onSerialConnected');\r\n        if(this.marlinDivStatus) {\r\n            this.marlinDivStatus.innerHTML = 'Status: <span class=\"w3-badge w3-grey\"></span>';\r\n        }\r\n    }\r\n    protected onSerialDisconnected() {\r\n        console.log('Marlin: onSerialDisconnected');\r\n        if(this.marlinDivStatus) {\r\n            this.marlinDivStatus.innerHTML = 'Status: <span class=\"w3-badge w3-grey\"></span>';\r\n        }\r\n    }\r\n\r\n    onBtnHome() {\r\n        this.serialWrite('G28'); // all relative\r\n    };\r\n    onBtnPos() {\r\n        this.serialWrite('M114');\r\n    };\r\n    onBtnRel() {\r\n        this.serialWrite('G91');\r\n    };\r\n    onBtnCold() {\r\n        this.serialWrite('M302 S0');\r\n    };\r\n\r\n    onBtnXP() {\r\n        this.serialWrite('G0 X10');\r\n    };\r\n    onBtnXM() {\r\n        this.serialWrite('G0 X-10');\r\n    };\r\n    onBtnYP() {\r\n        this.serialWrite('G0 Y10');\r\n    };\r\n    onBtnYM() {\r\n        this.serialWrite('G0 Y-10');\r\n    };\r\n    onBtnZP() {\r\n        this.serialWrite('G0 Z10');\r\n    };\r\n    onBtnZM() {\r\n        this.serialWrite('G0 Z-10');\r\n    };\r\n    onBtnEP() {\r\n        this.serialWrite('G0 E10');\r\n    };\r\n    onBtnEM() {\r\n        this.serialWrite('G0 E-10');\r\n    };\r\n}\r\n"],"names":["a","g","t","e","TypeError","c","o","length","s","enumerable","configurable","writable","Object","defineProperty","key","i","arguments","r","n","this","x","y","ctx","canvas","color","font","setPos","bind","prototype","h","value","addEventListener","removeEventListener","getBoundingClientRect","Math","floor","clientX","left","clientY","top","concat","save","fillStyle","width","measureText","v","height","fillText","restore","d","f","b","l","lineWidth","startX","startY","endX","endY","beginPath","strokeStyle","moveTo","lineTo","stroke","j","step","boldNth","boldColor","boldWidth","lines","push","$","createLines","forEach","draw","drawText","Mouse","Grid","$c0e850328e6b509c$exports","$d86f0ae2c7fe36e0$export$8215d14a63d9fb10","inputQueue","inputLast","constructor","deviceCheck","document","getElementById","deviceConnect","deviceDisconnect","deviceDosome","deviceInput","deviceInputForm","deviceLog","port","textDecoder","TextDecoderStream","onclick","serialCheck","serialConnect","serialDisconnect","serialDosome","onsubmit","serialInputForm","async","result","navigator","updatePorts","serial","event","console","log","warn","getPorts","then","ports","usbProductId","usbVendorId","getInfo","serialError","error","innerHTML","onSerialConnected","onSerialDisconnected","requestPort","open","baudRate","val","onconnect","ondisconnect","setTimeout","serialRead","catch","toString","readable","pipeTo","reader","getReader","serialReadon","done","read","releaseLock","pushedStuff","indexOf","values","split","serialCallback","elem","latest","pop","utf8Encode","TextEncoder","writer","getWriter","write","encode","close","preventDefault","serialInputChange","text","obj","right","parent","dimension","content","scoreFunction","bubbleUp","sinkDown","peek","remove","Error","size","u","kdTree","Array","isArray","root","sort","slice","toJSON","insert","nearest","p","abs","min","balanceFactor","max","BinaryHeap","define","amd","$8a913147b03fa214$exports","$54033deb9df7af75$var$BoundingBox","minx","miny","maxx","maxy","update","center","zoom","zero","$54033deb9df7af75$var$PadStyle","form","w","$54033deb9df7af75$var$Pad","style","posX","posY","$54033deb9df7af75$export$bdf465113f979d8f","fileName","mouseFlag","mouseStartX","mouseStartY","mouseOffX","mouseOffY","mapStyles","Map","mapPads","bb","rect","padstyle","keys","sty","get","padset","sw","sh","pad","fillRect","fill","ellipse","PI","near","addPadStyle","name","set","addPad","has","Set","newpad","add","retree","pads","padsets","tree","distance","err","mouseDown","trans","getTransform","mouseUp","offsetTop","mx","my","sqrt","mouseMove","mouseWheel","deltaY","static","pow","$b4e14b6b8da86996$var$body","getElementsByTagName","$b4e14b6b8da86996$var$uploadButton","$b4e14b6b8da86996$var$padsField","$b4e14b6b8da86996$var$coordsField","$b4e14b6b8da86996$var$dropZone","$b4e14b6b8da86996$var$canvas","$b4e14b6b8da86996$var$progress","$b4e14b6b8da86996$var$progressbar","$b4e14b6b8da86996$var$progressCancel","$b4e14b6b8da86996$var$header","$b4e14b6b8da86996$var$footer","$b4e14b6b8da86996$var$mouse","$b4e14b6b8da86996$var$grid","$b4e14b6b8da86996$var$pcb","$b4e14b6b8da86996$var$ctx","$b4e14b6b8da86996$var$floatFracts","$b4e14b6b8da86996$var$floatDezis","$b4e14b6b8da86996$var$lastPad","$b4e14b6b8da86996$var$cancel","$b4e14b6b8da86996$var$reNumFormat","$b4e14b6b8da86996$var$reMatchPad","$b4e14b6b8da86996$var$reMatchPadCoordInit","$b4e14b6b8da86996$var$reMatchPadCoord","super","marlinDiv","marlinDivStatus","marlinBtnHome","onBtnHome","marlinBtnPos","onBtnPos","marlinBtnRel","onBtnRel","marlinBtnCold","onBtnCold","marlinBtnXP","onBtnXP","marlinBtnXM","onBtnXM","marlinBtnYP","onBtnYP","marlinBtnYM","onBtnYM","marlinBtnZP","onBtnZP","marlinBtnZM","onBtnZM","marlinBtnEP","onBtnEP","marlinBtnEM","onBtnEM","serialWrite","$b4e14b6b8da86996$var$update","window","requestAnimationFrame","setTransform","clearRect","$b4e14b6b8da86996$var$processGerberFile","file","arrayBuffer","buf","encoding","callback","blob","innerText","display","replace","lineNr","line","$b4e14b6b8da86996$var$processGerberLine","$b4e14b6b8da86996$var$processGerberText","Blob","type","FileReader","onload","evt","target","readAsText","Promise","resolve","matchNumFormat","exec","parseInt","matchPad","parseFloat","matchPadCoordInit","matchPadCoord","startsWith","sx","sy","len","fx","fy","substring","globalThis","accordionToggler","id","className","getContext","uploadFileEle","createElement","click","ev","files","alert","ondrop","dataTransfer","items","item","kind","getAsFile","ondragover","innerWidth","innerHeight","track"],"version":3,"file":"index.ec4efd1d.js.map"}