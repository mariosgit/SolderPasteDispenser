var t={};!function(){var e={};function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var s=0;s<e.length;s++){var o=e[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"16px Monospace",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;s(this,t),this.x=a,this.y=h,this.ctx=e,this.canvas=o,this.color=i,this.font=n,this.setPos=this.setPos.bind(this)}return function(t,e,s){e&&o(t.prototype,e),s&&o(t,s)}(t,[{key:"track",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.canvas;return t?e.addEventListener("mousemove",this.setPos):e.removeEventListener("mousemove",this.setPos),this}},{key:"setPos",value:function(t){var e=this.canvas.getBoundingClientRect();return this.x=Math.floor(t.clientX-e.left),this.y=Math.floor(t.clientY-e.top),this}},{key:"draw",value:function(){var t=this.x,e=this.y,s=this.canvas,o=this.ctx,i=this.font,n=this.color,a="X: ".concat(t,", Y: ").concat(e);o.save(),o.fillStyle=n,o.font=i;var h=t<s.width/2?20:-o.measureText(a).width-20,l=e<s.height/2?25:-18;return o.fillText(a,this.x+h,this.y+l),o.restore(),this}}]),t}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var s=0;s<e.length;s++){var o=e[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function h(t,e,s){return e&&a(t.prototype,e),s&&a(t,s),t}var l=function(){function t(e,s,o,i,a,h){n(this,t),this.color=e,this.lineWidth=s,this.startX=o,this.startY=i,this.endX=a,this.endY=h}return h(t,[{key:"draw",value:function(t){var e=this.color,s=this.lineWidth,o=this.startX,i=this.startY,n=this.endX,a=this.endY;t.save(),t.beginPath(),t.strokeStyle=e,t.lineWidth=s,t.moveTo(o,i),t.lineTo(n,a),t.stroke(),t.restore()}}]),t}(),r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gray",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DarkGray",h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.5,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"16px Monospace";n(this,t),this.color=e,this.lineWidth=s,this.step=o,this.boldNth=i,this.boldColor=a,this.boldWidth=h,this.font=l,this.lines=null}return h(t,[{key:"createLines",value:function(t){for(var e=this.color,s=this.lineWidth,o=this.step,i=this.boldNth,n=this.boldColor,a=this.boldWidth,h=[],r=i*o,d=0;d<t.width;d+=o){var c=d%r==0;h.push(c?new l(n,a,d,0,d,t.height):new l(e,s,d,0,d,t.height))}for(var u=0;u<t.height;u+=o){var f=u%r==0;h.push(f?new l(n,a,0,u,t.width,u):new l(e,s,0,u,t.width,u))}this.lines=h}},{key:"drawText",value:function(t,e){var s=this.step,o=this.boldNth,i=this.boldColor,n=this.font;t.save(),t.font=n,t.fillStyle=i,t.fillText("0",1,15);for(var a=s*o;a<e.width;a+=s*o)t.fillText(a,a,15);for(var h=s*o;h<e.height;h+=s*o)t.fillText(h,0,h+15);t.restore()}},{key:"draw",value:function(t,e){this.lines||this.createLines(e),this.lines.forEach((function(e){return e.draw(t)})),this.drawText(t,e)}}]),t}();e.Mouse=i,e.Grid=r,t=e}();const e=document.getElementsByTagName("body")[0],s=document.getElementById("fileInput"),o=document.getElementById("uploadButton"),i=document.getElementById("padsField"),n=document.getElementById("coordsField"),a=document.getElementById("dropZone"),h=document.getElementById("canvas"),l=document.getElementById("progress"),r=document.getElementsByTagName("header")[0],d=document.getElementsByTagName("footer")[0];let c,u,f,m=null;class g{constructor(t,e,s){this.form=t,this.width=e,this.height=s}}class v{constructor(t,e,s){this.posX=e,this.posY=s,this.style=t}}class p{fileName="";mouseFlag=!1;mouseStartX=0;mouseStartY=0;mouseOffX=0;mouseOffY=0;zoom=6;constructor(t,e){this.ctx=t,this.canvas=e,this.mapStyles=new Map,this.mapPads=new Map}draw(){this.ctx.fillStyle="antiquewhite",this.ctx.beginPath(),this.ctx.moveTo(-10+this.mouseOffX,0+this.mouseOffY),this.ctx.lineTo(10+this.mouseOffX,0+this.mouseOffY),this.ctx.moveTo(0+this.mouseOffX,-10+this.mouseOffY),this.ctx.lineTo(0+this.mouseOffX,10+this.mouseOffY),this.ctx.stroke(),this.ctx.beginPath();for(let t of this.mapPads.keys()){const e=this.mapStyles.get(t),s=this.mapPads.get(t);if(e&&s){const t=e.width*this.zoom,o=e.height*this.zoom;for(let i of s.values())if("R"==e.form||"O"==e.form)this.ctx.fillRect(i.posX*this.zoom-t/2+this.mouseOffX,i.posY*this.zoom-o/2+this.mouseOffY,t,o);else{if("C"!=e.form){console.log(`draw quatsch ${e}`);break}this.ctx.arc(i.posX*this.zoom-t/2+this.mouseOffX,i.posY*this.zoom-o/2+this.mouseOffY,e.width*this.zoom,0,359)}}}this.ctx.fill()}addPadStyle(t,e,s,o){this.mapStyles.set(t,new g(e,s,o))}addPad(t,e,s){this.mapPads.has(t)||this.mapPads.set(t,new Set);let o=this.mapPads.get(t);o&&o.add(new v(t,e,s))}mouseDown(t){this.mouseStartX=t.clientX-this.mouseOffX,this.mouseStartY=t.clientY-this.mouseOffY,this.mouseFlag=!0}mouseUp(t){this.mouseFlag=!1}mouseMove(t){this.mouseFlag&&(this.mouseOffX=t.clientX-this.mouseStartX,this.mouseOffY=t.clientY-this.mouseStartY)}mouseWheel(t){console.log(t.deltaY),t.deltaY>0?this.zoom*=1.1:this.zoom*=.9}}function w(){h&&m&&(window.requestAnimationFrame(w),m.clearRect(0,0,h.width,h.height),u.draw(m,h),c.draw(),f&&f.draw())}function y(t){s&&o&&i&&n&&e&&m&&l&&t.arrayBuffer().then((e=>{var s,o,r,d;s="UTF-8",o=e=>{l.style.display="block";const s=document.getElementById("progressbar");f=new p(m,h),a&&(a.innerText=t.name);const o=(e=e.replace(/\r/g,"")).split("\n");let r=1,d=1,c="",u=1;for(let t of o){u++;const e=t.match(/^%FSLAX([0-9])([0-9])Y([0-9])([0-9])[*]%/);e&&(d=parseInt(e[1]),r=parseInt(e[2]),console.log(`gerber: float digits = ${d} ${r}`));const a=t.match(/^(%AD)(D[0-9]+)([A-Za-z])[,]([0-9.]+)[X]?([0-9.]+)?/);a&&(i.innerHTML+=`${a[2]} ${a[4]} ${a[5]}<br>`,f.addPadStyle(a[2],a[3],parseFloat(a[4]),parseFloat(a[5])),console.log(`gerber: style ${a[2]},${a[3]}, ${parseFloat(a[4])}, ${parseFloat(a[5])}`));const h=t.match(/^X([-]?)([0-9]+)Y([-]?)([0-9]+)D([0-9]+)[*]/),l=t.match(/^(D[0-9]+)[*]/);if(l&&(c=l[1]),h){let t=h[2],e=h[4];const i=d+r;for(;t.length<i;)t=`0${t}`;for(;e.length<i;)e=`0${e}`;let a=0,l=0;if(t=`${t.substring(0,d)}.${t.substring(d)}`,e=`${e.substring(0,d)}.${e.substring(d)}`,a=parseFloat(t),l=parseFloat(e),"-"==h[1]&&(a*=-1),"-"==h[3]&&(l*=-1),n.innerHTML+=`${c}:  x:${a} y:${l} <br>`,f.addPad(c,a,l),console.log(`gerber(${u}/${o.length}): pad ${c}, ${a}, ${l}`),s&&(s.style.width=100*u/o.length+"%"),u>1500)break}}l.style.display="none"},r=new Blob([e],{type:"text/plain"}),(d=new FileReader).onload=t=>{o(t.target.result)},d.readAsText(r,s)}))}document.addEventListener("DOMContentLoaded",(function(){console.log("moinsen"),s&&o&&i&&n&&e&&h?(m=h.getContext("2d"),h.addEventListener("mousemove",(t=>{f&&f.mouseMove(t)}),!1),h.addEventListener("mousedown",(t=>{f&&f.mouseDown(t)}),!1),h.addEventListener("mouseup",(t=>{f&&f.mouseUp(t)}),!1),h.addEventListener("mouseout",(t=>{f&&f.mouseUp(t)}),!1),h.addEventListener("wheel",(t=>{f&&f.mouseWheel(t)}),!1),o.onclick=()=>{if(s.files&&s.files.length>0){let t=s.files[0];console.log(t),console.log(`file: ${t.name} size:${t.size}`),y(t)}else alert("please choose a file")},e.ondrop=t=>{t.preventDefault(),console.log(t),t.dataTransfer.items?[...t.dataTransfer.items].forEach(((t,e)=>{if("file"===t.kind){const s=t.getAsFile();s&&(console.log(`… item[${e}].name = ${s.name}`),y(s))}})):[...t.dataTransfer.files].forEach(((t,e)=>{t&&(console.log(`… file[${e}].name = ${t.name}`),y(t))}))},e.ondragover=t=>{console.log("File(s) in drop zone"),t.preventDefault()},h.width=innerWidth,h.height=innerHeight-r.getBoundingClientRect().height-d.getBoundingClientRect().height-7,c=new(0,t.Mouse)(m,h),c.track(),u=new(0,t.Grid),window.requestAnimationFrame(w)):console.error("missing html elements !")})),window.addEventListener("resize",(t=>{console.log(`resize: ${t}`),h&&r&&d&&(h.width=innerWidth,h.height=innerHeight-r.getBoundingClientRect().height-d.getBoundingClientRect().height-7,c.draw(),u.draw(m,h))}));
//# sourceMappingURL=index.611c68f5.js.map
